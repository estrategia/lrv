function alerta(a){$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})}function cerrarTour(){tour&&tour.complete()}function noMostrarMas(){Cookies.set("mobileTour","noMostrar",{expires:365}),cerrarTour()}function volverAMostrar(){return Cookies.get("mobileTour")}function iniciarTour(){intervalTour=setInterval(iniciarTourInterval,500)}function iniciarTourInterval(){$("#map .gmnoprint map").length>0&&(clearInterval(intervalTour),intervalTour=null,iniciarTourAux())}function iniciarTourAux(){"noMostrar"!=volverAMostrar()&&tour.start()}function animarRelacionado(){$("html, body").animate({scrollTop:0},600),$("#link-relacionados-agregar").css("opacity",""),intervalRelacionados=setInterval(function(){$("#link-relacionados-agregar").animate({opacity:"0.5"},400,function(){$("#link-relacionados-agregar").animate({opacity:"1"},400)})},1e3),$("#link-relacionados-agregar").css("display",""),setTimeout(function(){null!=intervalRelacionados&&(clearInterval(intervalRelacionados),intervalRelacionados=null),$("#link-relacionados-agregar").css("opacity","")},1e4)}function quitarRelacionado(){null!=intervalRelacionados&&(clearInterval(intervalRelacionados),intervalRelacionados=null),$("#link-relacionados-agregar").css("display","none"),$("#link-relacionados-agregar").css("opacity",""),$("#link-relacionados-agregar").attr("href","#")}function ubicacionGPS(){navigator.geolocation?($.mobile.loading("show"),navigator.geolocation.getCurrentPosition(obtenerPosicion,errorPosicion,{enableHighAccuracy:!0,timeout:3e4,maximumAge:0})):alert("Servicio no soportado por este navegador.")}function obtenerPosicion(a){var o=0,e=0;a&&(o=a.coords.latitude,e=a.coords.longitude),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/sitio/gps",data:{lat:o,lon:e},beforeSend:function(){$("#popup-ubicacion-gps").remove()},success:function(a){"ok"==a.result?($("#ubicacion-seleccion-ciudad").val(a.response.ciudad).attr("data-ciudad"),$("#ubicacion-seleccion-sector").val(a.response.sector).attr("data-sector"),$("#ubicacion-seleccion-direccion").val(""),ubicacionSeleccion()):a.responseModal?$("<div>").mdialog({content:a.responseModal}):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}),$.mobile.loading("hide")},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}function ubicacionSeleccion(){var a=$("#form-ubicacion");$.ajax({type:"POST",async:!0,url:requestUrl+"/sitio/ubicacionSeleccion",data:a.serialize(),dataType:"json",beforeSend:function(){$.mobile.loading("show")},complete:function(a){$.mobile.loading("hide")},success:function(a){"ok"==a.result?(dialogoAnimado(a.response),a.urlAnterior?location.href=a.urlAnterior:location.href=requestUrl+"/sitio/inicio"):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){$.mobile.loading("hide"),alert(e)}})}function errorPosicion(a){$.mobile.loading("hide");var o="NA";switch(a.code){case a.PERMISSION_DENIED:o="Por favor activar/habilitar servicio de ubicación de tu dispositivo.";break;case a.POSITION_UNAVAILABLE:o="Posición no disponible.";break;case a.TIMEOUT:o="Expiró el tiempo de espera.";break;case a.UNKNOWN_ERROR:o="Error desconocido: "+a.message}alert(o)}function subtotalUnidadProducto(a){var o=$("#cantidad-producto-unidad-"+a).val();o=parseInt(o),isNaN(o)&&(o=1),1>=o&&(o=1),$("#cantidad-producto-unidad-"+a).val(o),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/subtotalUnidad",data:{codigo:a,cantidad:o},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(o){"ok"==o.result?$("#subtotal-producto-unidad-"+a).html(o.response.valorFormato):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}function subtotalParcialProductoFraccion(a,o,e){var i=parseInt($("#cantidad-producto-fraccion-"+a).val());isNaN(i)&&(i=0),0>i&&(i=0),$("#cantidad-producto-fraccion-"+a).val(i);var r=Math.floor(o/e),t=$("#cantidad-producto-unidad-"+a).val();if(t=parseInt(t),isNaN(t)&&(t=0),0>t&&(t=0),i>=r){var n=Math.floor(i/r),c=i%r;t+=n,i=c}$("#cantidad-producto-unidad-"+a).val(t),$("#cantidad-producto-fraccion-"+a).val(i),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/subtotalFraccion",data:{codigo:a,cantidadUnidad:t,cantidadFraccion:i},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(o){"ok"==o.result?($("#subtotal-producto-unidad-"+a).html(o.response.valorUnidadFormato),$("#subtotal-producto-fraccion-"+a).html(o.response.valorFraccionFormato),$("#total-producto-"+a).html(o.response.valorTotalFormato)):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}function subtotalProductoBodega(a){var o=parseInt($("#cantidad-producto-ubicacion-"+a).val());isNaN(o)&&(o=0),0>o&&(o=0);var e=$("#cantidad-producto-bodega-"+a).val();e=parseInt(e),isNaN(e)&&(e=0),0>e&&(e=0),$("#cantidad-producto-ubicacion-"+a).val(o),$("#cantidad-producto-bodega-"+a).val(e),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/subtotalBodega",data:{codigo:a,bodega:e,ubicacion:o},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(o){"ok"==o.result?($("#subtotal-producto-bodega-"+a).html(o.response.valorBodegaFormato),$("#subtotal-producto-ubicacion-"+a).html(o.response.valorUbicacionFormato),$("#total-producto-"+a).html(o.response.valorTotalFormato)):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}function subtotalCombo(a){var o=$("#cantidad-combo-"+a).val();o=parseInt(o),isNaN(o)&&(o=1),1>=o&&(o=1),$("#cantidad-combo-"+a).val(o),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/subtotalCombo",data:{codigo:a,cantidad:o},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(o){"ok"==o.result?$("#subtotal-combo-"+a).html(o.response.valorFormato):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}function subtotalProductoCarro(a){var o=$("#cantidad-producto-"+a).val();o=parseInt(o),isNaN(o)&&(o=1),1>=o&&(o=1),$("#cantidad-producto-"+a).val(o),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/modificar",data:{id:a,cantidad:o},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"==a.result?($("#div-carro").html(a.carro),$("#div-carro").trigger("create"),$("#panel-carro-canasta").html(a.canasta),$("#panel-carro-canasta").trigger("create")):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}function ratyclic(a,o){alert("ID ratyclik: "+this.id+"\nscore: "+a+"\nevent: "+o.type)}function recalcularFiltros(a){var o={};$("input[id^='FiltroForm_listMarcas_']").each(function(){$(this).is(":checked")&&(o[$(this).val()]=parseInt($(this).val()))});var e={};$("input[id^='FiltroForm_listFiltros_']").each(function(){$(this).is(":checked")&&(e[$(this).val()]=parseInt($(this).attr("data-filtro")))}),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/filtro",data:{marcas:o,atributos:e,tipo:a},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){a.hasOwnProperty("marcas")&&($("#div-filtro-marcas").html(a.marcas),$("#div-filtro-marcas").trigger("create")),a.hasOwnProperty("atributos")&&($("#div-filtro-atributos").html(a.atributos),$("#div-filtro-atributos").trigger("create"))},error:function(a,o,e){alert("Error: "+e)}})}function verUbicacion(){"0"==$("#ubicacion-info").attr("data-active")?($("#ubicacion-info").removeClass("hide"),$("#ubicacion-info").addClass("display"),$("#ubicacion-info").attr("data-active","1")):($("#ubicacion-info").removeClass("display"),$("#ubicacion-info").addClass("hide"),$("#ubicacion-info").attr("data-active","0"))}function pasoTipoEntrega(a,o,e){var i={siguiente:o,"FormaPagoForm[indicePuntoVenta]":$('input[name="FormaPagoForm[indicePuntoVenta]"]').val(),"FormaPagoForm[tipoEntrega]":$('input[name="FormaPagoForm[tipoEntrega]"]').val()};$.ajax({type:"POST",async:!0,url:requestUrl+"/carro/pagar/paso/"+a+"/post/true",data:$.param(i),beforeSend:function(){e.button("disable"),$('div[id^="FormaPagoForm_"].has-error').html(""),$('div[id^="FormaPagoForm_"].has-error').css("display","none"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){var o=$.parseJSON(a);"ok"===o.result?window.location.replace(o.redirect):"error"===o.result?(alerta(o.response),e.button("enable")):($.each(o,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")}),e.button("enable"))},error:function(a,o,i){alert("Error: "+i),e.button("enable")}})}function pasoDespacho(a,o,e){var i={siguiente:o,direccion:$('input[name="FormaPagoForm[idDireccionDespacho]"]:checked').val()};$.ajax({type:"POST",async:!0,url:requestUrl+"/carro/pagar/paso/"+a+"/post/true",data:$.param(i)+"&"+$("#form-direccion-pagoinvitado").serialize(),beforeSend:function(){e.button("disable"),$('div[id^="FormaPagoForm_"].has-error').html(""),$('div[id^="FormaPagoForm_"].has-error').css("display","none"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){var o=$.parseJSON(a);"ok"===o.result?window.location.replace(o.redirect):"error"===o.result?(alerta(o.response),e.button("enable")):($.each(o,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")}),e.button("enable"))},error:function(a,o,i){alert("Error: "+i),e.button("enable")}})}function pasoEntrega(a,o,e){var i={siguiente:o};$.ajax({type:"POST",async:!0,url:requestUrl+"/carro/pagar/paso/"+a+"/post/true",data:$.param(i)+"&"+$("#form-pago-entrega").serialize(),beforeSend:function(){e.button("disable"),$('div[id^="FormaPagoForm_"].has-error').html(""),$('div[id^="FormaPagoForm_"].has-error').css("display","none"),$("#form-pago-entrega").trigger("create"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){var o=$.parseJSON(a);"ok"===o.result?window.location.replace(o.redirect):"error"===o.result?(alerta(o.response),e.button("enable")):($.each(o,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")}),e.button("enable"))},error:function(a,o,i){alert("Error: "+i),e.button("enable")}})}function pasoPago(a,o,e){var i={siguiente:o};$.ajax({type:"POST",async:!0,url:requestUrl+"/carro/pagar/paso/"+a+"/post/true",data:$.param(i)+"&"+$("#form-pago-pago").serialize(),beforeSend:function(){e.button("disable"),$('div[id^="FormaPagoForm_"].has-error').html(""),$('div[id^="FormaPagoForm_"].has-error').css("display","none"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){var o=$.parseJSON(a);"ok"===o.result?window.location.replace(o.redirect):"error"===o.result?(alerta(o.response),e.button("enable")):($.each(o,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")}),e.button("enable"))},error:function(a,o,i){alert("Error: "+i),e.button("enable")}})}function pasoConfirmacion(a,o,e){var i={siguiente:o};$.ajax({type:"POST",async:!0,url:requestUrl+"/carro/pagar/paso/"+a+"/post/true",data:$.param(i)+"&"+$("#form-pago-confirmacion").serialize(),beforeSend:function(){e.button("disable"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){var o=$.parseJSON(a);"ok"===o.result?window.location.replace(o.redirect):"error"===o.result?(alerta(o.response),e.button("enable")):($.each(o,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")}),e.button("enable"))},error:function(a,o,i){alert("Error: "+i),e.button("enable")}})}function pagoCredirebaja(a,o){if($(a).length){var e=$('input[name="'+o+'[idFormaPago]"]:checked').val();void 0==e||0==$("#"+o+"_idFormaPago_"+e).attr("data-credirebaja")?($('[id="div-credirebaja"] input').attr("disabled","disabled"),$('[id="div-credirebaja"] select').attr("disabled","disabled"),$("#div-credirebaja").css("display","none")):($('[id="div-credirebaja"] input').removeAttr("disabled"),$('[id="div-credirebaja"] select').removeAttr("disabled"),$("#div-credirebaja").css("display","block"))}}function colapseDireccion(){if($("#form-pagoexpess").length){var a=$('input[name="PagoExpress[idDireccionDespacho]"]:checked').val();$("div[id^=div-infodireccion-]").css("display","none"),void 0!==a&&$("#div-infodireccion-"+a).css("display","block")}}function seleccionTipoEntrega(a,o){$('div[data-role="tipoentrega"]').removeClass("activo"),$('div[data-role="tipoentrega"]div[data-tipo="'+a+'"]').addClass("activo"),$('div[data-role="tipoentrega"]').addClass("inactivo"),$('div[data-role="tipoentrega"]div[data-tipo="'+a+'"]').removeClass("inactivo"),$("#FormaPagoForm_tipoEntrega").val(a),$('input[name="FormaPagoForm[indicePuntoVenta]"]').val("")}function visualizarFormulaMedica(){$("#FormaPagoForm_confirmacion").prop("checked")?$("#form-formula-medica").removeClass("display-none"):$("#form-formula-medica").addClass("display-none")}intervalRelacionados=null;var tour;tour=new Shepherd.Tour({defaults:{classes:"shepherd-theme-default",scrollTo:!0}});var intervalTour=null;tour.addStep("arrastra-mapa",{text:"Arrastra el mapa y ubica el marcador en el lugar donde te encuentras.",attachTo:"#map .gmnoprint map bottom",when:{show:function(){resizingMap(),locationMarker.setPosition(map.getCenter())}},buttons:[{text:"Enterado",action:function(){noMostrarMas()}},{text:"Siguiente",action:tour.next}]}),tour.addStep("confirma-ubicacion",{text:"Para finalizar presiona el boton confirmar.",attachTo:"#confirma-ubicacion top",buttons:[{text:"Enterado",action:function(){noMostrarMas()}},{text:"Cerrar",action:tour.next}]}),$(document).on("click",'a[data-role="ubicacion-seleccion-mapa"]',function(){var a=0,o=0;map&&(a=map.getCenter().lat(),o=map.getCenter().lng()),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/sitio/gps",data:{lat:a,lon:o},beforeSend:function(){$.mobile.loading("show")},success:function(a){"ok"==a.result?($("#ubicacion-seleccion-ciudad").val(a.response.ciudad),$("#ubicacion-seleccion-sector").val(a.response.sector),$("#ubicacion-seleccion-direccion").val(""),ubicacionSeleccion()):a.responseModal?$("<div>").mdialog({content:a.responseModal}):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}),$.mobile.loading("hide")},error:function(a,o,e){$.mobile.loading("hide"),alert(e)}})}),$(document).on("click",'button[data-role="seleccion-barrio"]',function(){return $("#page-ubicacion-barrio").length>0?($("#ubicacion-barrios-respuesta").html(""),$.mobile.changePage("#page-ubicacion-barrio",{transition:"pop",role:"dialog",reverse:!1})):$.ajax({type:"GET",async:!0,url:requestUrl+"/sitio/seleccionBarrio",dataType:"html",beforeSend:function(){$.mobile.loading("show")},complete:function(a){$.mobile.loading("hide")},success:function(a){$("body").append(a),$.mobile.changePage("#page-ubicacion-barrio",{transition:"pop",role:"dialog",reverse:!1})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}}),!1}),$(document).on("click",'button[data-role="ubicacion-barrio"]',function(){var a=$("#selector-ciudad").val(),o=$("input[name='barrio']").val();return $.ajax({type:"post",async:!0,url:requestUrl+"/sitio/ubicacionBarrio",data:{ciudad:a,barrio:o},dataType:"json",beforeSend:function(){$.mobile.loading("show")},complete:function(a){$.mobile.loading("hide")},success:function(a){"ok"==a.result?a.response?($("#ubicacion-seleccion-ciudad").val(a.response.ciudad),$("#ubicacion-seleccion-sector").val(a.response.sector),$("#ubicacion-seleccion-direccion").val(""),ubicacionSeleccion()):a.responseHTML?($("#ubicacion-barrios-respuesta").html(a.responseHTML),$("#ubicacion-barrios-respuesta").trigger("create")):($.mobile.loading("hide"),alert("Respuesta incorrecta")):($.mobile.loading("hide"),alert(a.response))},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}}),!1}),$(document).on("click",'a[data-role="ubicacion-barriosOpciones"], li[data-role="ubicacion-barriosOpciones"]',function(){return $("#ubicacion-seleccion-ciudad").val($(this).attr("data-ciudad")),$("#ubicacion-seleccion-sector").val($(this).attr("data-sector")),$("#ubicacion-seleccion-direccion").val(""),ubicacionSeleccion(),!1}),$(document).on("change",'select[data-role="ciudad-despacho-map"]',function(){var a=$(this).val().trim();if(a.length>0){var o=$('select[data-role="ciudad-despacho-map"] option[value="'+a+'"]').attr("selected","selected");lat=parseFloat(o.attr("data-latitud")),lng=parseFloat(o.attr("data-longitud"))}}),$(document).on("click",'button[data-role="seleccionar-ciudad"]',function(){return $("#seleccion-ciudad").length>0?$.mobile.changePage("#seleccion-ciudad",{transition:"pop",role:"dialog",reverse:!1}):$.ajax({type:"POST",dataType:"html",async:!0,url:requestUrl+"/sitio/ciudades",beforeSend:function(){$.mobile.loading("show")},success:function(a){$("body").append(a),$.mobile.changePage("#seleccion-ciudad",{transition:"pop",reverse:!1,position:"window"}),$.mobile.loading("hide")},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}}),!1}),$(document).on("click",'a[data-role="confirmar-seleccion-ciudad"]',function(){return $("#page-ubicacion-map").length>0?($.mobile.changePage("#page-ubicacion-map",{transition:"pop",role:"dialog",reverse:!1}),map.setZoom(15),resizeMap()):$.ajax({type:"POST",dataType:"html",async:!0,url:requestUrl+"/sitio/mapa",beforeSend:function(){$.mobile.loading("show")},success:function(a){$.getScript("https://maps.googleapis.com/maps/api/js?client="+gmapKey).done(function(o,e){$.getScript(requestUrl+"/js/ubicacion.min.js").done(function(o,e){$("body").append(a),inicializarMapa(),$.mobile.changePage("#page-ubicacion-map",{transition:"pop",role:"dialog",reverse:!1}),map.setZoom(15),resizeMap(),$.mobile.loading("hide"),setTimeout(function(){iniciarTour()},2e3)}).fail(function(a,o,e){$.mobile.loading("hide"),alert("Error al inicializar mapa: "+e)})}).fail(function(a,o,e){$.mobile.loading("hide"),alert("Error al cargar mapa: "+e)})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}}),!1}),$(document).on("click",'button[data-role="ubicacion-direccion"]',function(){return $.ajax({type:"GET",async:!0,url:requestUrl+"/usuario/direccionesUbicacion",dataType:"html",beforeSend:function(){$("div[id='page-direccionesubicacion']").remove(),$.mobile.loading("show")},complete:function(a){$.mobile.loading("hide")},success:function(a){$("body").append(a),$.mobile.changePage("#page-direccionesubicacion",{transition:"pop",role:"dialog",reverse:!1})},error:function(a,o,e){Loading.hide(),bootbox.alert("Error: "+e)}}),!1}),$(document).on("click",'button[data-role="ubicacion-seleccion-direccion"]',function(){$("#ubicacion-seleccion-ciudad").val(""),$("#ubicacion-seleccion-sector").val(""),$("#ubicacion-seleccion-direccion").val($(this).attr("data-direccion")),ubicacionSeleccion()}),$(document).on("click",'a[data-role="ubicacion-seleccion-nodomicilio"]',function(){$("#ubicacion-seleccion-ciudad").val($(this).attr("data-ciudad")),$("#ubicacion-seleccion-sector").val($(this).attr("data-sector")),$("#ubicacion-seleccion-direccion").val(""),ubicacionSeleccion()}),$(document).on("click","a[data-eliminar='1'], a[data-eliminar='2'], a[data-eliminar='3']",function(){var a=$(this).attr("data-position"),o=$(this).attr("data-eliminar");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/eliminar",data:{id:a,eliminar:o},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"==a.result?($("#div-carro").html(a.carro),$("#div-carro").trigger("create"),$("#panel-carro-canasta").html(a.canasta),$("#panel-carro-canasta").trigger("create")):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}),$(document).on("click","a[data-role='carrovaciar']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/vaciar",beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"==a.result?($("#div-carro").html(a.carro),$("#div-carro").trigger("create"),$("#panel-carro-canasta").html(a.canasta),$("#panel-carro-canasta").trigger("create")):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}),$(document).on("pagecreate",function(a){$(function(){$(window).scroll(function(){$(this).scrollTop()>100?$("a.scroll-top").fadeIn():$("a.scroll-top").fadeOut()}),$("a.scroll-top").click(function(){return $("html, body").animate({scrollTop:0},600),!1})}),$("[data-role='raty']").raty({starOn:requestUrl+"/libs/raty/images/star-on.png",starOff:requestUrl+"/libs/raty/images/star-off.png",starHalf:requestUrl+"/libs/raty/images/star-half.png",cancelOn:requestUrl+"/libs/raty/images/cancel-on.png",cancelOff:requestUrl+"/libs/raty/images/cancel-off.png",hints:["mala","deficiente","regular","buena","excelente"],noRatedMsg:"Sin calificación",readOnly:function(){return"true"===$(this).attr("data-readonly")},click:function(a,o){if($(this).attr("data-callback")){var e=$(this).attr("data-callback");window[e](a,o)}},score:function(){return $(this).attr("data-score")}}),$("[id^='owl-productodetalle-']").owlCarousel({navigation:!1,slideSpeed:300,paginationSpeed:400,singleItem:!0,autoPlay:1e4}),$("[id^='slide-relacionados']").owlCarousel({slideSpeed:300,paginationSpeed:400,autoPlay:3e3,items:4,itemsDesktop:[1e3,5],itemsDesktopSmall:[900,3],itemsTablet:[600,2],itemsMobile:[300,2]}),$("[id^='slide-imagenes']").owlCarousel({autoPlay:3e3,items:2,itemsDesktop:[1199,3],itemsDesktopSmall:[979,3]}),pagoCredirebaja("#form-pago-pago","FormaPagoForm"),pagoCredirebaja("#form-pagoexpess","PagoExpress"),colapseDireccion(),$(function(){var a=$("textarea[data-countchar]");a.length&&countChar(a,a.attr("data-countchar"))}),$("div[id^='collapsible-direccion-ciudad-']").on("collapsiblecollapse",function(a,o){$("div[id^='div-direccion-form-']").css("display","none"),$("input[id^='DireccionesDespacho_idDireccionDespacho_']").removeAttr("checked"),$("input[id^='DireccionesDespacho_idDireccionDespacho_']").checkboxradio("refresh")})}),$(document).on("click","button[data-role='calificacion']",function(){var a=$(this).attr("data-producto"),o=$("#calificacion-titulo-"+a),e=$("#calificacion-comentario-"+a),i=$("#calificacion-raty-"+a).raty("score");return i=parseInt(i),isNaN(i)&&(i=0),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/calificar",data:{codigo:a.trim(),titulo:o.val().trim(),comentario:e.val().trim(),calificacion:i},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(o){"ok"===o.result?($("[data-role='calificacion']").remove(),$("#calificacion-raty-"+a).raty("readOnly",!0),$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}}),!1}),$(document).on("change","input[id^='FiltroForm_listMarcas_']",function(){recalcularFiltros(1)}),$(document).on("change","input[id^='FiltroForm_listFiltros_']",function(){recalcularFiltros(2)}),$(document).on("click","a[data-cargar='1']",function(){var a=$(this).attr("data-producto"),o=$("#cantidad-producto-unidad-"+a).val();o=parseInt(o),isNaN(o)&&(o=-1);var e=parseInt($("#cantidad-producto-fraccion-"+a).val());e=parseInt(e),isNaN(e)&&(e=-1),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregar",data:{producto:a,cantidadU:o,cantidadF:e},beforeSend:function(){quitarRelacionado(),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(o){"ok"===o.result?($("#panel-carro-canasta").html(o.response.canastaHTML),$("#panel-carro-canasta").trigger("create"),o.response.mensajeHTML&&(dialogoAnimado(o.response.mensajeHTML),$("#icono-producto-agregado-"+a).addClass("active")),o.response.dialogoHTML&&$("<div>").mdialog({content:o.response.dialogoHTML}),o.response.relacionados&&$("#link-relacionados-agregar").length>0&&($("#link-relacionados-agregar").attr("href",requestUrl+"/catalogo/relacionados/producto/"+a),animarRelacionado())):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}),$(document).on("click","a[data-cargar='2']",function(){var a=$(this).attr("data-combo"),o=$("#cantidad-combo-"+a).val();o=parseInt(o),isNaN(o)&&(o=0),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarCombo",data:{combo:a,cantidad:o},beforeSend:function(){$.mobile.loading("show"),quitarRelacionado()},complete:function(){$.mobile.loading("hide")},success:function(o){"ok"===o.result?($("#panel-carro-canasta").html(o.response.canastaHTML),$("#panel-carro-canasta").trigger("create"),o.response.mensajeHTML&&(dialogoAnimado(o.response.mensajeHTML),$("#icono-combo-agregado-"+a).addClass("active")),o.response.dialogoHTML&&$("<div>").mdialog({content:o.response.dialogoHTML})):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}),$(document).on("click","a[data-cargar='3']",function(){var a=$(this).attr("data-producto"),o=$("#cantidad-producto-ubicacion-"+a).val();o=parseInt(o),isNaN(o)&&(o=0);var e=parseInt($("#cantidad-producto-bodega-"+a).val());e=parseInt(e),isNaN(e)&&(e=0),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarBodega",data:{producto:a,cantidadU:o,cantidadB:e},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"===a.result?($("#panel-carro-canasta").html(a.response.canastaHTML),$("#panel-carro-canasta").trigger("create"),a.response.mensajeHTML&&dialogoAnimado(a.response.mensajeHTML),a.response.dialogoHTML&&$("<div>").mdialog({content:a.response.dialogoHTML})):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}),$(document).on("change","input[data-modificar='1'], input[data-modificar='2'], input[data-modificar='3']",function(){var a=$(this).attr("data-position"),o=$(this).attr("data-modificar"),e={modificar:o,position:a};if(1==o){var i=parseInt($("#cantidad-producto-fraccion-"+a).val());isNaN(i)?i=-1:1>i&&(i=1);var r=parseInt($("#cantidad-producto-unidad-"+a).val());if((isNaN(r)||1>r)&&(r=1),i>0){var t=parseInt($(this).attr("data-nfracciones")),n=parseInt($(this).attr("data-ufraccionamiento")),c=Math.floor(t/n);if(i>=c){var l=Math.floor(i/c),s=i%c;r+=l,i=s}}e.cantidadU=r,e.cantidadF=i}else if(2==o){var d=parseInt($("#cantidad-producto-"+a).val());(isNaN(d)||1>d)&&(d=1),e.cantidad=d}else if(3==o){var d=parseInt($("#cantidad-producto-bodega-"+a).val());(isNaN(d)||1>d)&&(d=1),e.cantidad=d}$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/modificar",data:e,beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"===a.result?($("#div-carro").html(a.response.carroHTML),$("#div-carro").trigger("create"),a.response.canastaHTML&&($("#panel-carro-canasta").html(a.response.canastaHTML),$("#panel-carro-canasta").trigger("create")),a.response.mensajeHTML&&dialogoAnimado(a.response.mensajeHTML),a.response.dialogoHTML&&$("<div>").mdialog({content:a.response.dialogoHTML})):($("#div-carro").html(a.response.carroHTML),$("#div-carro").trigger("create"),$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response.message+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}))},error:function(a,o,e){alert("Error: "+e)}})}),$(document).on("change",'input[name="DireccionesDespacho[idDireccionDespacho]"]:radio',function(a){var o=$('input[name="DireccionesDespacho[idDireccionDespacho]"]:checked').val();$("div[id^='div-direccion-form-']").css("display","none"),$("#div-direccion-form-"+o).css("display","block"),$("html,body").animate({scrollTop:$("#div-direccion-form-"+o).offset().top},200)}),$(document).on("click","input[id^='btn-direccion-actualizar-']",function(){var a=$(this).parents("form");return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/direccionActualizar",data:a.serialize(),beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(o){var e=$.parseJSON(o);"ok"===e.result||("error"===e.result?alert(e.response):$.each(e,function(o,e){$("#"+a.attr("id")+" #"+o+"_em_").html(e),$("#"+a.attr("id")+" #"+o+"_em_").css("display","block")}))},error:function(a,o,e){alert("Error: "+e)}}),!1}),$(document).on("click","a[data-role='direccion-adicionar-modal']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/direccionCrear",data:{render:!0},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){var o="page-direccion-crear-"+uniqueId(),e="<div data-role='page' id='"+o+"'><div data-role='main' class='ui-content'>"+a.response.dialogoHTML+"<a href='#' class='ui-btn ui-btn-n ui-corner-all ui-shadow' data-rel='back'>Cerrar</a></div></div>";$("body").append(e),$.mobile.changePage("#"+o,{transition:"pop",
role:"dialog",reverse:!1})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","input[data-role='direccion-adicionar']",function(){var a=$(this).parents("form"),o=$(this).attr("data-modal"),e={modal:o};return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/direccionCrear",data:$.param(e)+"&"+a.serialize(),beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(e){var e=$.parseJSON(e);"ok"===e.result?1==o?($("#div-direcciones-lista").html(e.response.direccionesHTML),$("#div-direcciones-lista").trigger("create"),$("div[id^='page-direccion-crear-']").dialog("close"),dialogoAnimado(e.response.mensaje)):location.reload():"error"===e.result?$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+e.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}):$.each(e,function(o,e){$("#"+a.attr("id")+" #"+o+"_em_").html(e),$("#"+a.attr("id")+" #"+o+"_em_").css("display","block")})},error:function(a,o,e){alert("Error: "+e)}}),!1}),$(document).on("click","input[id^='btn-direccion-eliminar-']",function(){var a=$(this).attr("data-direccion");return $.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/direccionEliminar",data:{direccion:a},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(o){"ok"===o.result?$("#div-direccion-radio-"+a).remove():"error"===o.result&&$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+o.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}}),!1}),$(document).on("click","input[id='btn-carropagar-siguiente'], input[id='btn-carropagar-anterior']",function(){var a=$(this).attr("data-origin"),o=$(this).attr("data-redirect");return"tipoentrega"==a?pasoTipoEntrega(a,o,$(this)):"despacho"===a?pasoDespacho(a,o,$(this)):"entrega"===a?pasoEntrega(a,o,$(this)):"pago"===a?pasoPago(a,o,$(this)):"confirmacion"===a&&pasoConfirmacion(a,o,$(this)),!1}),$(document).on("change",'input[name="FormaPagoForm[idFormaPago]"]:radio',function(a){pagoCredirebaja("#form-pago-pago","FormaPagoForm")}),$(document).on("change",'input[name="PagoExpress[idFormaPago]"]:radio',function(a){pagoCredirebaja("#form-pagoexpess","PagoExpress"),$("#PagoExpress_idFormaPago_em_").html("")}),$(document).on("change",'input[name="PagoExpress[idDireccionDespacho]"]:radio',function(a){colapseDireccion(),$("#PagoExpress_idDireccionDespacho_em_").html("")}),$(document).on("change","#FormaPagoForm_numeroTarjeta",function(){var a=$(this).val();a=parseInt(a),isNaN(a)&&$(this).val("")}),$(document).on("click","a[data-role='pedidodetalle']",function(){var a=$(this).attr("data-compra");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarcompra",data:{compra:a},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"===a.result?($("#panel-carro-canasta").html(a.response.canastaHTML),$("#panel-carro-canasta").trigger("create"),a.response.mensajeHTML&&dialogoAnimado(a.response.mensajeHTML),a.response.dialogoHTML&&$("<div>").mdialog({content:a.response.dialogoHTML})):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","a[data-role='cotizaciondetalle']",function(){var a=$(this).attr("data-cotizacion");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarcotizacion",data:{cotizacion:a},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"===a.result?($("#panel-carro-canasta").html(a.response.canastaHTML),$("#panel-carro-canasta").trigger("create"),a.response.mensajeHTML&&dialogoAnimado(a.response.mensajeHTML),a.response.dialogoHTML&&$("<div>").mdialog({content:a.response.dialogoHTML})):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","a[data-role='pedidolistaocultar']",function(){var a=$(this).attr("data-compra");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/ocultarpedido",data:{compra:a},beforeSend:function(){$.mobile.loading("show")},success:function(a){"ok"===a.result?($.fn.yiiGridView.update("grid-cuenta-listapedidos"),$.mobile.loading("hide")):($.mobile.loading("hide"),$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}))},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","a[data-role='pedidogridestado']",function(){$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+$(this).attr("data-estado")+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})}),$(document).on("click","a[data-role='listapersonal']",function(){var a=$(this).attr("data-lista");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarlista",data:{lista:a},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"===a.result?($("#panel-carro-canasta").html(a.response.canastaHTML),$("#panel-carro-canasta").trigger("create"),a.response.mensajeHTML&&dialogoAnimado(a.response.mensajeHTML),a.response.dialogoHTML&&$("<div>").mdialog({content:a.response.dialogoHTML})):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","input[data-role='lstpersonalform']",function(){var a={},o=$(this).attr("data-lista");void 0!==o&&(a.lista=o),$.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/listapersonal/lista/post",data:$.param(a)+"&"+$("#form-listapersonal").serialize(),beforeSend:function(){$('div[id^="ListasPersonales_"].has-error').html(""),$('div[id^="ListasPersonales_"].has-error').css("display","none"),$("#form-listapersonal input[type=button]").attr("disabled","disabled"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide"),$("#form-listapersonal input[type=button]").removeAttr("disabled")},success:function(a){var a=$.parseJSON(a);"ok"===a.result?($("#ListaGuardarForm_idLista").length&&$("#ListaGuardarForm_idLista").append(a.response.optionHtml),$("#gridview-listapersonal").length&&($("#form-listapersonal")[0].reset(),$.fn.yiiGridView.update("gridview-listapersonal")),$(".ui-collapsible").collapsible("collapse"),dialogoAnimado(a.response.mensajeHtml)):"error"===a.result?$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}):$.each(a,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("change","input[data-role='actualizarlistadetalle']",function(){var a=$(this).attr("data-detalle"),o=$(this).val();o=parseInt(o),isNaN(o)&&(o=0),0>=o&&(o=0),$(this).val(o),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/listadetalle/accion/actualizar",data:{detalle:a,unidades:o},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"===a.result?($("#div-listadetalle").html(a.response.detalleHTML),$("#div-listadetalle").trigger("create"),dialogoAnimado(a.response.mensajeHTML)):"error"===a.result&&$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","a[data-role='eliminarlistadetalle']",function(){var a=$(this).attr("data-detalle");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/listadetalle/accion/eliminar",data:{detalle:a},beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"===a.result?($("#div-listadetalle").html(a.response.detalleHTML),$("#div-listadetalle").trigger("create"),dialogoAnimado(a.response.mensajeHTML)):"error"===a.result&&$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","a[data-role='lstpersonalguardar']",function(){var a=$(this).attr("data-tipo");a=parseInt(a),isNaN(a)&&(a=-1);var o=$(this).attr("data-codigo"),e=0;1===a?(e=$("#cantidad-producto-unidad-"+o).val(),e=parseInt(e),isNaN(e)&&(e=0)):2===a&&(e=$("#cantidad-combo-"+o).val(),e=parseInt(e),isNaN(e)&&(e=0)),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/listapersonal/lista/guardar",data:{codigo:o,tipo:a,unidades:e,render:!0},beforeSend:function(){$("div[id^='page-listaguardar-']").remove(),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){if("ok"===a.result){var o="page-listaguardar-"+uniqueId(),e="<div data-role='page' id='"+o+"'><div data-role='main' class='ui-content'>"+a.response.dialogoHTML+"<a href='#' class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back'>Cerrar</a></div></div>";$("body").append(e),$.mobile.changePage("#"+o,{transition:"pop",role:"dialog",reverse:!1})}else"error"===a.result&&$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","input[data-role='lstpersonalguardar']",function(){$.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/listapersonal/lista/guardar",data:$("#form-listaguardar").serialize(),beforeSend:function(){$('div[id^="ListaGuardarForm_"].has-error').html(""),$('div[id^="ListaGuardarForm_"].has-error').css("display","none"),$("#form-listaguardar input[type=button]").attr("disabled","disabled"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide"),$("#form-listaguardar input[type=button]").removeAttr("disabled")},success:function(a){var a=$.parseJSON(a);"ok"===a.result?($("div[id^='page-listaguardar-']").dialog("close"),dialogoAnimado(a.response)):"error"===a.result?$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}):$.each(a,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("click","a[data-role='cambioubicacion']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/vacio",data:$("#form-listaguardar").serialize(),beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){"ok"==a.result?a.response?window.location.replace(requestUrl+"/sitio/ubicacion"):$("#popup-cambioubicacion").popup("open"):$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}})}),$(document).on("keyup","input[type='number']",function(){var a=-1;$(this).attr("maxlength")&&(a=parseInt($(this).attr("maxlength")),isNaN(a)&&(a=-1)),$(this).val().length>0?a>0&&$(this).val().length>a&&$(this).val($(this).val().substr(0,a)):$(this).val("")}),$(document).on("click","input[data-role='pagopasarela']",function(){var boton=$(this);$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/pagopasarela",beforeSend:function(){boton.button("disable"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(data){"ok"==data.result?($("#div-pasarela-info form").remove(),$("#div-pasarela-info").append(data.response),eval(data.analytics),$('form[id="form-pasarela"]').submit()):(boton.button("enable"),$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+data.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}))},error:function(a,o,e){boton.button("enable"),alert("Error: "+e)}})}),$(document).on("click","a[data-role='crearcotizacion']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/crearcotizacion",beforeSend:function(){$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(a){$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})},error:function(a,o,e){alert("Error: "+e)}})}),$(document).on("click","#form-registro input[data-registro='registro']",function(){var a=$(this).parents("form"),o=$(this);return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/registro",data:a.serialize(),beforeSend:function(){o.button("disable"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(e){var i=$.parseJSON(e);"ok"===i.result?($("#main-page").html(i.response.bienvenidaHTML),$("#main-page").trigger("create")):"error"===i.result?(o.button("enable"),$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+i.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})):(o.button("enable"),$.each(i,function(o,e){$("#"+a.attr("id")+" #"+o+"_em_").html(e),$("#"+a.attr("id")+" #"+o+"_em_").css("display","block")}))},error:function(a,e,i){o.button("enable"),alert("Error: "+i)}}),!1}),$(document).on("click","#form-autenticar input[data-registro='autenticar']",function(){var a=$(this).parents("form"),o=$(this);return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/ingresar",data:a.serialize(),beforeSend:function(){o.button("disable"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(e){var i=$.parseJSON(e);"ok"===i.result?window.location.replace(i.response.redirect):"error"===i.result?(o.button("enable"),$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+i.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})):(o.button("enable"),$.each(i,function(o,e){$("#"+a.attr("id")+" #"+o+"_em_").html(e),$("#"+a.attr("id")+" #"+o+"_em_").css("display","block")}))},error:function(a,e,i){o.button("enable"),alert("Error: "+i)}}),!1}),$(document).on("click","#form-recordar input[data-registro='recordar']",function(){var a=$(this).parents("form"),o=$(this);return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/recordar",data:a.serialize(),beforeSend:function(){o.button("disable"),$.mobile.loading("show")},complete:function(){$.mobile.loading("hide")},success:function(e){var i=$.parseJSON(e);"ok"===i.result?(o.button("enable"),a.trigger("reset"),$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+i.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})):"error"===i.result?(o.button("enable"),$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+i.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})):(o.button("enable"),$.each(i,function(o,e){$("#"+a.attr("id")+" #"+o+"_em_").html(e),$("#"+a.attr("id")+" #"+o+"_em_").css("display","block")}))},error:function(a,e,i){o.button("enable"),alert("Error: "+i)}}),!1}),$(document).on("change","#form-listapersonal input[id='ListasPersonales_estadoLista']",function(){$(this).is(":checked")?$("#div-lista-config-recordacion").removeClass("hide"):$("#div-lista-config-recordacion").addClass("hide")}),$(document).on("click","a[data-role='tooltip']",function(){var a="autotooltip-"+uniqueId(),o=$(this).attr("data-arrow")?$(this).attr("data-arrow"):"t",e="<div data-role='popup' id='"+a+"' class='ui-content' data-arrow='"+o+"' data-theme='a'><p>"+$(this).attr("data-msg")+"</p></div>";$("body").append(e),$("#"+a).popup({positionTo:$(this),afterclose:function(o,e){$("#"+a).remove()}}),$("#"+a).popup("open")}),$(document).on("click",'div[data-role="tipoentrega"], a[data-role="tipoentrega"]',function(){var a=$(this).attr("data-tipo"),o=a==tipoEntrega.presencial?tipoEntrega.domicilio:tipoEntrega.presencial;a==tipoEntrega.presencial?$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/pasoporel",data:{opcion:"modal"},beforeSend:function(){$("#page-pasoporel").remove(),$.mobile.loading("show")},success:function(a){"ok"==a.result?($("body").append(a.response),$.mobile.changePage("#page-pasoporel",{transition:"pop",role:"dialog",reverse:!1})):alert(a.response),$.mobile.loading("hide")},error:function(a,o,e){$.mobile.loading("hide"),alert("Error: "+e)}}):seleccionTipoEntrega(a,o)}),$(document).on("click",'button[data-role="pasoporel-seleccion-pdv"]',function(){seleccionTipoEntrega(tipoEntrega.presencial,tipoEntrega.domicilio),$('input[name="FormaPagoForm[indicePuntoVenta]"]').val($(this).attr("data-idx")),$("#page-pasoporel").dialog("close")}),$(document).on("click",'a[data-role="popup-pagoexpress"]',function(){return $("#popup-pagoexpress").popup("open"),!1}),$(document).on("click",'a[data-role="tipoentrega-info"]',function(){var a=$(this).attr("href");return a?($(a).panel("open"),!1):void 0}),$(document).ready(function(){$(".lst_ub_cdd .ui-collapsible-heading-toggle").click(function(){$("li a.c_btn_sel").removeClass("ui-btn-active2"),$(".list_ciud.ui-listview li").removeClass("active2")}),$("a.c_btn_sel").click(function(){$("li a.c_btn_sel").removeClass("ui-btn-active2"),$(".list_ciud.ui-listview li").removeClass("active2"),$(this).addClass("ui-btn-active2"),$(this).parent("li").addClass("active2")})}),$(document).on("click","#btn-adicionar-formula",function(){var a=document.getElementById("form-pago-confirmacion"),o=document.createElement("input");return o.type="hidden",o.value=$(this).attr("data-tipo"),o.name="tipo-formula",o.id="tipo-formula",a.appendChild(o),$.ajax({type:"POST",url:requestUrl+"/carro/adicionarFormula/",data:new FormData(a),dataType:"json",cache:!1,contentType:!1,processData:!1,beforeSend:function(){$.mobile.loading("show")},complete:function(a){$.mobile.loading("hide")},success:function(a){"ok"===a.result?($("#formulasAdicionadas").html(a.response),$("#FormulasMedicas_nombreMedico").val(""),$("#FormulasMedicas_institucion").val(""),$("#FormulasMedicas_registroMedico").val(""),$("#FormulasMedicas_descripcion").val(""),$("#FormulasMedicas_formulaMedica").val(""),$("#FormulasMedicas_telefono").val(""),$("#FormulasMedicas_correoElectronico").val("")):"error"===a.result||$.each(a,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")})}}),!1});var bono;$(document).on("click","input[data-role='codigo-promocional']",function(){var a=$("#codigoPromocional").val();return $.ajax({type:"POST",url:requestUrl+"/carro/usarCodigo/",data:{codigoPromocional:a},dataType:"json",beforeSend:function(){$.mobile.loading("show")},complete:function(a){$.mobile.loading("hide")},success:function(a){"ok"===a.result?(bono=a.bono,$("<div>").mdialog({content:"<div data-role='main' id='modal-codigo-promo'><div class='ui-content' data-role='content' role='main' >"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' data-bono='"+a.bono+"' data-role='usar-codigo' href='#'>Usar</a><a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Cancelar</a></div></div>"})):"error"===a.result?$("<div>").mdialog({content:"<div data-role='main'><div class='ui-content'  data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"}):$.each(a,function(a,o){$("#"+a+"_em_").html(o),$("#"+a+"_em_").css("display","block")})}}),!1}),$(document).on("click","a[data-role='usar-codigo']",function(){$.ajax({type:"POST",url:requestUrl+"/carro/guardarCodigo/",data:{bono:$(this).attr("data-bono")},dataType:"json",beforeSend:function(){$.mobile.loading("show")},complete:function(a){$.mobile.loading("hide")},success:function(a){return"ok"==a.result?($("#FormaPagoForm-usoBonoPromocional").val(1),$("#FormaPagoForm-usoBonoPromocional").prop("disabled",!1),$("#modal-codigo-promo").remove(),$("#codigoPromocional").val(""),$("#usoCodigo").html(a.response),!1):void $("<div>").mdialog({content:"<div data-role='main'><div class='ui-content' data-role='content' role='main'>"+a.response+"<a class='ui-btn ui-btn-r ui-corner-all ui-shadow' data-rel='back' href='#'>Aceptar</a></div></div>"})}})});