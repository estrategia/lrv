function alert(a){bootbox.alert({message:a,callback:function(){},buttons:{ok:{label:"Aceptar",className:"btn-danger"}}})}function iniciarTour(){0==tipoTour&&tour.start(),1==tipoTour&&tourAuto.start()}function cerrarTour(){tour.complete(),tourAuto.complete()}function listaProductoVistaActualizar(){listaProductoVista($('button[data-role="tipovista-listaproductos"]button[data-active="true"]').attr("data-type"))}function listaProductoVista(a){"lineal"===a?($(".descripcion-grid").css("display","none"),$(".descripcion-lineal").css("display","block"),listaProductoLineal()):"cuadricula"===a&&($(".descripcion-grid").css("display","block"),$(".descripcion-lineal").css("display","none"),listaProductoCuadricula())}function listaProductoLineal(){$("#lista-productos").removeClass("list_cuadricula"),$("#lista-productos").addClass("list_lineal"),$("#lista-productos.list_lineal .listaProductos li .content-txt2").addClass("row"),$("#lista-productos.list_lineal .listaProductos li .content-txt2 .img-list-products").addClass("col-sm-3"),$("#lista-productos.list_lineal .listaProductos li .content-txt2 .content_product").addClass("col-sm-5"),$("#lista-productos.list_lineal .listaProductos li .content-txt2 .botones-list").addClass("col-sm-4")}function listaProductoCuadricula(){$("#lista-productos").removeClass("list_lineal"),$("#lista-productos").addClass("list_cuadricula"),$("#lista-productos.list_cuadricula .listaProductos li .content-txt2").removeClass("row"),$("#lista-productos.list_cuadricula .listaProductos li .content-txt2 .img-list-products").removeClass("col-sm-3"),$("#lista-productos.list_cuadricula .listaProductos li .content-txt2 .content_product").removeClass("col-sm-5"),$("#lista-productos.list_cuadricula .listaProductos li .content-txt2 .botones-list").removeClass("col-sm-4")}function ajustebuscador(){widhtControl=$(".content-category .controls").width(),widhtBoton=$(".content-category .controls #btn-buscador-productos").width(),widhtDrop=$(".content-category .controls .float-right").width(),width=widhtControl-(widhtBoton+widhtDrop),$(".content-category .controls >span").width(width+6)}function ajuesmenu(){widhtNav=$("nav.main_menu").width(),widtCat=.25*widhtNav,$(".main_menu .categorias").width(widtCat),widht=$(".main_menu .categorias").width(),widhtDocument=widhtNav-widht,$(".categorias .category > li").width(widht),$(".categorias .category > li .right-nav").width(widhtDocument),total=$(".main_menu .modulo-menu").length,itemswidth=widhtDocument/total,$(".main_menu .modulo-menu").width(itemswidth)}function isEmptyStr(a){return!a||0===a.length}function modificarCarro(a,b){var c={modificar:b,position:a};if(1==b){var d=parseInt($("#cantidad-producto-fraccion-"+a).val());isNaN(d)?d=-1:d<1&&(d=1);var e=parseInt($("#cantidad-producto-unidad-"+a).val());if((isNaN(e)||e<1)&&(e=1),d>0){var f=parseInt($("#cantidad-producto-fraccion-"+a).attr("data-nfracciones")),g=parseInt($("#cantidad-producto-fraccion-"+a).attr("data-ufraccionamiento")),h=Math.floor(f/g);if(d>=h){var i=Math.floor(d/h),j=d%h;e+=i,d=j}}c.cantidadU=e,c.cantidadF=d}else if(2==b){var k=parseInt($("#cantidad-producto-"+a).val());(isNaN(k)||k<1)&&(k=1),c.cantidad=k}else if(3==b){var k=parseInt($("#cantidad-producto-bodega-"+a).val());(isNaN(k)||k<1)&&(k=1),c.cantidad=k}$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/modificar",data:c,beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?($("#div-carro").html(a.response.carroHTML),$("#div-carro").trigger("create"),a.response.canastaHTML&&($("#div-carro-canasta").html(a.response.canastaHTML),$("#div-carro-canasta").trigger("create")),a.response.dialogoHTML&&(a.response.bodega?($("#modalBodegas").remove(),$("body").append(a.response.dialogoHTML),$("#modalBodegas").modal("show")):alert(a.response.dialogoHTML))):($("#div-carro").html(a.response.carroHTML),$("#div-carro").trigger("create"),alert(a.response.message))},error:function(a,b,c){alert("Error: "+c)}})}function pasoInformacion(a,b,c){var d={siguiente:b,"FormaPagoForm[idDireccionDespacho]":$('input[name="FormaPagoForm[idDireccionDespacho]"]:checked').val(),"FormaPagoForm[indicePuntoVenta]":$('input[name="FormaPagoForm[indicePuntoVenta]"]').val(),"FormaPagoForm[tipoEntrega]":$('input[name="FormaPagoForm[tipoEntrega]"]').val()};$.ajax({type:"POST",async:!0,url:requestUrl+"/carro/pagar/paso/"+a+"/post/true",data:$.param(d)+"&"+$("#form-pago-comentario").serialize()+"&"+$("#form-direccion-pagoinvitado").serialize()+"&"+$("#form-pago-entrega").serialize()+"&"+$("#form-pago-pago").serialize()+"&"+$("#form-pago-bono").serialize(),beforeSend:function(){c.prop("disabled",!0),$('div[id^="FormaPagoForm_"].text-danger').html(""),$('div[id^="FormaPagoForm_"].text-danger').css("display","none"),Loading.show()},complete:function(){Loading.hide()},success:function(a){var b=$.parseJSON(a);"ok"===b.result?(c.prop("disabled",!1),window.location.replace(b.redirect)):"error"===b.result?(Loading.hide(),alert(b.response),c.prop("disabled",!1)):($.each(b,function(a,b){$("#"+a+"_em_").html(b),$("#"+a+"_em_").css("display","block")}),c.prop("disabled",!1),Loading.hide())},error:function(a,b,d){Loading.hide(),alert("Error: "+d),c.prop("disabled",!1)}})}function pasoConfirmacion(a,b,c){var d={siguiente:b};$.ajax({type:"POST",async:!0,url:requestUrl+"/carro/pagar/paso/"+a+"/post/true",data:$.param(d)+"&"+$("#form-pago-confirmacion").serialize(),beforeSend:function(){c.prop("disabled",!0),Loading.show()},complete:function(){Loading.hide()},success:function(a){var b=$.parseJSON(a);"ok"===b.result?window.location.replace(b.redirect):"error"===b.result?(alert(b.response),c.prop("disabled",!1)):($.each(b,function(a,b){$("#"+a+"_em_").html(b),$("#"+a+"_em_").css("display","block")}),c.prop("disabled",!1))},error:function(a,b,d){alert("Error: "+d),c.prop("disabled",!1)}})}function recalcularFiltros(a){var b={};$("input[id^='FiltroForm_listMarcas_']").each(function(){$(this).is(":checked")&&(b[$(this).val()]=parseInt($(this).val()))});var c={};$("input[id^='FiltroForm_listFiltros_']").each(function(){$(this).is(":checked")&&(c[$(this).val()]=parseInt($(this).attr("data-filtro")))}),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/filtro",data:{marcas:b,atributos:c,tipo:a},beforeSend:function(){Loading.show()},success:function(a){a.hasOwnProperty("marcas")&&($("#div-filtro-marcas").html(a.marcas),$("#div-filtro-marcas").trigger("create")),a.hasOwnProperty("atributos")&&($("#div-filtro-atributos").html(a.atributos),$("#div-filtro-atributos").trigger("create")),filtrarListaProductos()},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}function ListViewProductsUpdate(){var a=$.fn.yiiListView.getUrl("id-productos-list");if(a){var b=a.split("?"),c=$.deparam.querystring("?"+(b[1]||""));if(c.categoriasBuscador&&"array"==jQuery.type(c.categoriasBuscador)){var d="";$.each(c.categoriasBuscador,function(a,b){b&&(d.length>0?d+="_"+b:d=""+b)}),c.categoriasBuscador=d}$.fn.yiiListView.update("id-productos-list",{data:c})}else $.fn.yiiListView.update("id-productos-list")}function filtrarListaProductos(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/filtrar",data:$("#form-filtro-listaproductos").serialize(),beforeSend:function(){Loading.show()},success:function(a){"ok"===a.result?ListViewProductsUpdate():(Loading.hide(),alert(a.response))},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}function setPrecioFiltroForm(a,b){$("#FiltroForm_precio_0_text").val("$"+format(a[0])),$("#FiltroForm_precio_1_text").val("$"+format(a[1])),$("#FiltroForm_precio_0").val(a[0]),$("#FiltroForm_precio_1").val(a[1]),b&&filtrarListaProductos()}function raty(){$("[data-role='raty']").raty({starOn:requestUrl+"/libs/raty/images/star-on.png",starOff:requestUrl+"/libs/raty/images/star-off.png",starHalf:requestUrl+"/libs/raty/images/star-half.png",cancelOn:requestUrl+"/libs/raty/images/cancel-on.png",cancelOff:requestUrl+"/libs/raty/images/cancel-off.png",hints:["mala","deficiente","regular","buena","excelente"],noRatedMsg:"Sin calificación",readOnly:function(){return"true"===$(this).attr("data-readonly")},click:function(a,b){if($(this).attr("data-callback")){var c=$(this).attr("data-callback");window[c](a,b)}},score:function(){return $(this).attr("data-score")}})}function capturarfiltrocalificacion(a,b){var c=a;c=parseInt(c),isNaN(c)&&(c=-1),$("#FiltroForm_calificacion").val(c),$("#calificacion-filtro-listaproductos").attr("data-score",c),filtrarListaProductos()}function actualizarNumerosPagina(){var a=$("#items-page").val();$.fn.yiiListView.update("id-productos-list",{data:{pageSize:a}})}function disminuirCantidadFraccionado(a,b,c,d,e,f){var g=$("#cantidad-producto-fraccion-"+a+"-"+f).val();if(g--,g<0){var g=$("#cantidad-producto-unidad-"+a+"-"+f).val();g--,g<0&&(g=0),$("#cantidad-producto-unidad-"+a+"-"+f).val(g),$("#subtotal-producto-unidad-"+a).html("$"+format(g*e)),g=b/c-1}$("#subtotal-producto-fraccion-"+a).html("$"+format(g*d)),$("#cantidad-producto-fraccion-"+a+"-"+f).val(g)}function aumentarCantidadFraccionado(a,b,c,d,e,f){var g=$("#cantidad-producto-fraccion-"+a+"-"+f).val();if(g++,g*c==b){var g=$("#cantidad-producto-unidad-"+a+"-"+f).val();g++,$("#cantidad-producto-unidad-"+a+"-"+f).val(g),$("#subtotal-producto-unidad-"+a).html("$"+format(g*e)),g=0}$("#subtotal-producto-fraccion-"+a).html("$"+format(g*d)),$("#cantidad-producto-fraccion-"+a+"-"+f).val(g)}function validarCantidadFraccionado(a,b,c,d,e,f){var g=$("#cantidad-producto-fraccion-"+a+"-"+f).val(),h=$("#cantidad-producto-unidad-"+a+"-"+f).val();if(g<0&&(g=0),g*c>=b){var i=Math.floor(g*c/b);h=1*h+i,$("#cantidad-producto-unidad-"+a+"-"+f).val(h),$("#subtotal-producto-unidad-"+a).html("$"+format(h*e)),g=g*c%b}$("#subtotal-producto-fraccion-"+a).html("$"+format(g*d)),$("#cantidad-producto-fraccion-"+a+"-"+f).val(g)}function aumentarCantidadUnidad(a,b){var c=$("#cantidad-producto-unidad-"+a).val();c<0&&(c=0),$("#subtotal-producto-unidad-"+a).html("$"+format(c*b)),$("#cantidad-producto-unidad-"+a).val(c)}function disminuirCantidadCombo(a,b){var c=$("#cantidad-combo-"+a).val();c--,c<0&&(c=0),$("#subtotal-producto-combo-"+a).html("$"+format(c*b)),$("#cantidad-combo-"+a).val(c)}function aumentarCantidadCombo(a,b){var c=$("#cantidad-combo-"+a).val();c++,c<0&&(c=0),$("#subtotal-producto-combo-"+a).html("$"+format(c*b)),$("#cantidad-combo-"+a).val(c)}function validarCantidadCombo(a,b){var c=$("#cantidad-producto-combo-"+a).val();c<0&&(c=0),$("#subtotal-producto-combo-"+a).html("$"+format(c*b)),$("#cantidad-producto-combo-"+a).val(c)}function guardarCalificacion(a,b,c){var d=$("#calificacion-titulo-"+a).val(),e=$("#calificacion-comentario-"+a).val(),f=$(b).val(),g=$("#form-calificacion");$.ajax({type:"POST",url:c,data:"codigo="+a+"&titulo="+d+"&calificacion="+f+"&comentario="+e+"&"+g.serialize(),dataType:"json",beforeSend:function(){Loading.show()},success:function(a){"ok"===a.result?($("[data-role='calificacion']").remove(),$("#calificacion-producto").html("<div class='col-md-6'>TU COMENTARIO HA SIDO PUBLICADO, ESTE SERÁ APROBADO POR UN MODERADOR EN LAS PRÓXIMAS HORAS</div>")):"error"===a.result?($("#dialog").html(a.response),$("#dialog").dialog("open")):$.each(a,function(a,b){$("#"+g.attr("id")+" #"+a+"_em_").html(b),$("#"+g.attr("id")+" #"+a+"_em_").css("display","block")})},error:function(a,b,c){Loading.hide(),alert("Error: "+c)},complete:function(a){Loading.hide()}})}function format(a){a+="";var b=a.replace(/\./g,"");return isNaN(b)?"":(b=b.toString().split("").reverse().join("").replace(/(?=\d*\.?)(\d{3})/g,"$1."),b=b.split("").reverse().join("").replace(/^[\.]/,""))}function cambioUnidadesUbicacion(a,b,c){var d=$("#cantidad-producto-ubicacion-"+a).val(),e=$("#cantidad-producto-bodega-"+a).val();0==c?d--:d++,d<0&&(d=0),$("#cantidad-producto-ubicacion-"+a).val(d);var f=b*d;$("#subtotal-producto-ubicacion-"+a).html("$"+format(f));var g=f+e*b;$("#total-producto-"+a).html("$"+format(g))}function cambioUnidadesBodega(a,b,c){var d=$("#cantidad-producto-bodega-"+a).val(),e=$("#cantidad-producto-ubicacion-"+a).val();0==c?d--:d++,d<0&&(d=0),$("#cantidad-producto-bodega-"+a).val(d);var f=b*d;$("#subtotal-producto-bodega-"+a).html("$"+format(f));var g=f+e*b;$("#total-producto-"+a).html("$"+format(g))}function ubicacionGPS(){navigator.geolocation?(Loading.show(),navigator.geolocation.getCurrentPosition(setCoords,errorPosicion,{enableHighAccuracy:!0,timeout:3e4,maximumAge:0}),tourIniGps&&(setTimeout(function(){iniciarTour()},1e3),tourIniGps=!1)):alert("Servicio no soportado por este navegador.")}function errorPosicion(a){Loading.hide();var b="NA";switch(a.code){case a.PERMISSION_DENIED:b="Por favor activar/habilitar servicio de ubicación de tu dispositivo.";break;case a.POSITION_UNAVAILABLE:b="Posición no disponible.";break;case a.TIMEOUT:b="Expiró el tiempo de espera.";break;case a.UNKNOWN_ERROR:b="Error desconocido: "+a.message}alert(b)}function setCoords(a){if($("#select-ubicacion-content").hide(),a&&(lat=a.coords.latitude,lng=a.coords.longitude),$("#modal-ubicacion-map").length>0){$("#modal-ubicacion-map").modal("show"),tourIniMap?setTimeout(function(){iniciarTour()},1e3):tourIniMap=!1;var b=new google.maps.LatLng(lat,lng);map.setCenter(b),map.setZoom(12),resizeMap()}else latitud=lat,longitud=lng,$.ajax({type:"POST",dataType:"html",async:!0,url:requestUrl+"/sitio/mapa",beforeSend:function(){Loading.show()},success:function(a){$.getScript("https://maps.googleapis.com/maps/api/js?client="+gmapKey).done(function(b,c){$.getScript(requestUrl+"/js/ubicacion.min.js").done(function(b,c){$("#main-page").append(a),inicializarMapa(),$("#modal-ubicacion-map").modal("show"),$("#select-ubicacion-content").hide();var d=new google.maps.LatLng(latitud,longitud);map.setCenter(d),map.setZoom(12),tourIniMap?setTimeout(function(){iniciarTour()},1e3):tourIniMap=!1,Loading.hide()}).fail(function(a,b,c){Loading.hide(),alert("Error al inicializar mapa: "+c)})}).fail(function(a,b,c){Loading.hide(),alert("Error al cargar mapa: "+c)})},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}});Loading.hide()}function seleccionTipoEntrega(a,b){$('div[data-role="tipoentrega"]').removeClass("activo"),$('div[data-role="tipoentrega"]div[data-tipo="'+a+'"]').addClass("activo"),$('div[data-role="tipoentrega"]').addClass("inactivo"),$('div[data-role="tipoentrega"]div[data-tipo="'+a+'"]').removeClass("inactivo"),$("#pasoporel-seleccion-pdv-nombre").html(""),$("#pasoporel-seleccion-pdv-direccion").html(""),$("#FormaPagoForm_tipoEntrega").val(a),$('div[data-role="tipoentrega-habilitar"]div[data-habilitar="'+a+'"]').removeClass("display-none"),$('div[data-role="tipoentrega-habilitar"]div[data-habilitar="'+a+'"] input').removeAttr("disabled"),$('div[data-role="tipoentrega-habilitar"]div[data-habilitar="'+b+'"]').addClass("display-none"),$('div[data-role="tipoentrega-habilitar"]div[data-habilitar="'+b+'"] input[type="text"]').val(""),$('div[data-role="tipoentrega-habilitar"]div[data-habilitar="'+b+'"] input[type="radio"]').prop("checked",!1),$('div[data-role="tipoentrega-habilitar"]div[data-habilitar="'+b+'"] input').attr("disabled","disabled")}function ubicacionSeleccion(){var a=$("#form-ubicacion");$.ajax({type:"POST",async:!0,url:requestUrl+"/sitio/ubicacionSeleccion",data:a.serialize(),dataType:"json",beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){"ok"==a.result?(dialogoAnimado(a.response),a.urlAnterior?window.location.replace(a.urlAnterior):window.location.replace(requestUrl)):alert(a.response)},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}function capturarcalificacionproducto(a,b){var c=a;c=parseInt(c),isNaN(c)&&(c=""),$("#CalificacionForm_calificacion").val(c),$("#calificacion_form").attr("data-score",c)}function visualizarFormulaMedica(){$("#FormaPagoForm_confirmacion").prop("checked")?$("#form-formula-medica").removeClass("display-none"):$("#form-formula-medica").addClass("display-none")}function mostrarTipoFormula(a){1==a?($("#describir-formula").removeClass("display-none"),$("#anexar-formula").addClass("display-none")):2==a&&($("#describir-formula").addClass("display-none"),$("#anexar-formula").removeClass("display-none"))}var tipoTour=0,tourIniGps=!0,tourIniMap=!0,tour;tour=new Shepherd.Tour({defaults:{classes:"shepherd-theme-default",scrollTo:!0}}),tour.addStep("selecciona-ciudad",{text:"Seleciona la ciudad donde te encuentras.",attachTo:"#select-ubicacion-psubsector bottom",buttons:[{text:"Siguiente",action:tour.next}]}),tour.addStep("arrastra-mapa",{text:"Arrastra el mapa y ubica el marcador en el lugar donde te encuentras.",attachTo:"#map .gmnoprint img bottom",when:{show:function(){resizingMap(),locationMarker.setPosition(map.getCenter())}},buttons:[{text:"Siguiente",action:tour.next}]}),tour.addStep("confirma-ubicacion",{text:"Para finalizar presiona el boton confirmar.",attachTo:"#confirma-ubicacion top",buttons:[{text:"Finalizar",action:tour.next}]});var tourAuto;tourAuto=new Shepherd.Tour({defaults:{classes:"shepherd-theme-default",scrollTo:!0}}),tourAuto.addStep("arrastra-mapa",{text:"Arrastra el mapa y ubica el marcador en el lugar donde te encuentras.",attachTo:"#map .gmnoprint img bottom",buttons:[{text:"Siguiente",action:tourAuto.next}]}),tourAuto.addStep("confirma-ubicacion",{text:"Para finalizar presiona el boton confirmar.",attachTo:"#confirma-ubicacion top",buttons:[{text:"Finalizar",action:tourAuto.next}]}),$(document).on("click",'button[data-role = "ubicacion-gps"]',function(){tipoTour=1}),$(document).on("click",'button[data-role = "ubicacion-mapa"]',function(){tipoTour=0}),$(document).on("click",'button[data-role="tipovista-listaproductos"]',function(){listaProductoVista($(this).attr("data-type")),$('button[data-role="tipovista-listaproductos"]').attr("data-active","false"),$(this).attr("data-active","true")}),$(document).ready(function(){$(".main_menu .categorias").click(function(){ajuesmenu()}),ajuesmenu(),ajustebuscador()}),$(window).resize(function(){ajuesmenu(),ajustebuscador()}),$(".main_menu .cuidado-personal > a").click(function(){return $(".main_menu .cuidado-personal .right-nav").hide(),$(this).next(".right-nav").show(),!1}),$(document).on("change",'input[name="DireccionesDespacho[idDireccionDespacho]"]:radio',function(a){var b=$('input[name="DireccionesDespacho[idDireccionDespacho]"]:checked').val();$("div[id^='div-direccion-form-']").css("display","none"),$("#div-direccion-form-"+b).css("display","block"),$("html,body").animate({scrollTop:$("#div-direccion-form-"+b).offset().top},200)}),$(document).on("click","button[data-role='direccion-editar']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/direccionActualizar",data:{render:!0,direccion:$(this).attr("data-direccion"),radio:$(this).attr("data-radio")},beforeSend:function(){$("#modal-nueva-direccion").remove(),Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"==a.result?($("body").append(a.response.dialogoHTML),$("#modal-nueva-direccion").modal("show")):alert(a.response)},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}),$(document).on("click","div[data-role='direccion-editar']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/direccionActualizar",data:{render:!0,direccion:$(this).attr("data-direccion"),radio:$(this).attr("data-vista")},beforeSend:function(){$("#modal-nueva-direccion").remove(),Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"==a.result?($("body").append(a.response.dialogoHTML),$("#modal-nueva-direccion").modal("show")):alert(a.response)},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}),$(document).on("click","input[data-role='direccion-actualizar']",function(){var a=$(this).parents("form");return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/direccionActualizar",data:$.param({radio:$(this).attr("data-radio")})+"&"+a.serialize(),beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(b){var b=$.parseJSON(b);"ok"===b.result?($("#modal-nueva-direccion").modal("hide"),dialogoAnimado(b.response.mensaje),b.response.direccionHTML&&$("#div-direccion-interior-"+b.response.direccion).html(b.response.direccionHTML)):"error"===b.result?alert(b.response):$.each(b,function(b,c){$("#"+a.attr("id")+" #"+b+"_em_").html(c),$("#"+a.attr("id")+" #"+b+"_em_").css("display","block")})},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}),!1}),$(document).on("click","a[data-role='direccion-adicionar-modal']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/direccionCrear",data:{render:!0},beforeSend:function(){Loading.show(),$("#modal-nueva-direccion").remove()},complete:function(){Loading.hide()},success:function(a){$("body").append(a.response.dialogoHTML),$("#modal-nueva-direccion").modal("show")},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}),$(document).on("click","input[data-role='direccion-adicionar']",function(){var a=$("#form-direccion"),b=$("[data-role='direccion-adicionar-modal']").attr("data-vista"),c={vista:b};return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/direccionCrear",data:$.param(c)+"&"+a.serialize(),beforeSend:function(){$('div[id^="DireccionesDespacho_"].text-danger').html(""),$('div[id^="DireccionesDespacho_"].text-danger').css("display","none"),Loading.show()},complete:function(){Loading.hide()},success:function(b){var b=$.parseJSON(b);"ok"===b.result?($("#modal-nueva-direccion").modal("hide"),dialogoAnimado(b.response.mensaje),$("#div-direcciones-pasoscompra").length?($("#div-direcciones-pasoscompra").html(b.response.direccionesHTML),$("#div-direcciones-pasoscompra").trigger("create")):($("#div-direcciones-lista").html(b.response.direccionesHTML),$("#div-direcciones-lista").trigger("create"))):"error"===b.result?alert(b.response):$.each(b,function(b,c){$("#"+a.attr("id")+" #"+b+"_em_").html(c),$("#"+a.attr("id")+" #"+b+"_em_").css("display","block")})},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}),!1}),$(document).on("click","button[data-role='direccion-eliminar']",function(){var a=$(this).attr("data-direccion");return $.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/direccionEliminar",data:{direccion:a},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(b){"ok"===b.result?($("#div-direccion-exterior-"+a).remove(),dialogoAnimado(b.response)):"error"===b.result&&alert(b.response)},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}),!1}),$(document).on("click","a[data-role='pedidodetalle']",function(){var a=$(this).attr("data-compra");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarcompra",data:{compra:a},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?($("#div-carro-canasta").html(a.response.canastaHTML),$("#div-carro-canasta").trigger("create"),a.response.mensajeHTML&&dialogoAnimado(a.response.mensajeHTML)):alert(a.response)},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}),$(document).on("click","a[data-role='pedidolistaocultar']",function(){var a=$(this).attr("data-compra");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/ocultarpedido",data:{compra:a},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?($.fn.yiiGridView.update("grid-cuenta-listapedidos"),dialogoAnimado(a.response)):alert(a.response)},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","a[data-role='cotizaciondetalle']",function(){var a=$(this).attr("data-cotizacion");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarcotizacion",data:{cotizacion:a},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?($("#div-carro-canasta").html(a.response.canastaHTML),$("#div-carro-canasta").trigger("create"),a.response.mensajeHTML&&dialogoAnimado(a.response.mensajeHTML)):alert(a.response)},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","[id^='enlace-pago-direccion-express-']",function(){var a=$(this).children("input");a.prop("checked",!0)}),$(document).on("click","a[data-role='usuario-pagoexpress-formapago']",function(){console.log("asdff");var a=$(this).children("input");a.prop("checked",!0)}),$(document).on("change","#form-listapersonal input[id='ListasPersonales_estadoLista']",function(){$(this).is(":checked")?$("#div-lista-config-recordacion").removeClass("hide"):$("#div-lista-config-recordacion").addClass("hide")}),$(document).on("click","input[data-role='lstpersonalform']",function(){var a={},b=$(this).attr("data-lista");void 0!==b&&(a.lista=b),$.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/listapersonal/lista/post",data:$.param(a)+"&"+$("#form-listapersonal").serialize(),beforeSend:function(){$('div[id^="ListasPersonales_"].has-error').html(""),$('div[id^="ListasPersonales_"].has-error').css("display","none"),$("#form-listapersonal input[type=button]").attr("disabled","disabled"),Loading.show()},complete:function(){Loading.hide(),$("#form-listapersonal input[type=button]").removeAttr("disabled")},success:function(a){var a=$.parseJSON(a);"ok"===a.result?($("#ListaGuardarForm_idLista").length&&$("#ListaGuardarForm_idLista").append(a.response.optionHtml),$("#gridview-listapersonal").length&&$.fn.yiiGridView.update("gridview-listapersonal"),$("#form-listapersonal")[0].reset(),$("#modal-lista-personal").modal("hide"),dialogoAnimado(a.response.mensajeHtml)):"error"===a.result?alert(a.response):$.each(a,function(a,b){$("#"+a+"_em_").html(b),$("#"+a+"_em_").css("display","block")})},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}),$(document).on("click","a[data-role='listapersonaleliminar']",function(){var a=$(this).attr("data-lista");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/listapersonaleliminar",data:{lista:a},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?($.fn.yiiGridView.update("gridview-listapersonal"),dialogoAnimado(a.response)):alert(a.response)},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","a[data-role='listapersonal']",function(){var a=$(this).attr("data-lista");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarlista",data:{lista:a},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?($("#div-carro-canasta").html(a.response.canastaHTML),$("#div-carro-canasta").trigger("create"),a.response.mensajeHTML&&dialogoAnimado(a.response.mensajeHTML)):alert(a.response)},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}),$(document).on("click","a[data-role='eliminarlistadetalle']",function(){var a=$(this).attr("data-detalle");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/listadetalle/accion/eliminar",data:{detalle:a},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?(dialogoAnimado(a.response.mensajeHTML),$("#div-listadetalle").html(a.response.detalleHTML),$("#div-listadetalle").trigger("create")):"error"===a.result&&alert(a.response)},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","a[data-role='actualizarlistadetalle']",function(){var a=$(this).attr("data-detalle"),b=$("#campo-producto-"+a).val();b=parseInt(b),isNaN(b)&&(b=0),b<=0&&(b=0),$("#campo-producto-"+a).val(b),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/listadetalle/accion/actualizar",data:{detalle:a,unidades:b},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?dialogoAnimado(a.response.mensajeHTML):"error"===a.result&&alert(a.response)},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","a[data-role='lstpersonalguardar']",function(){var a=$(this).attr("data-tipo"),b=$(this).attr("data-id");a=parseInt(a),isNaN(a)&&(a=-1);var c=$(this).attr("data-codigo"),d=0;return 1===a?(d=$("#cantidad-producto-unidad-"+c+"-"+b).val(),d=parseInt(d),isNaN(d)&&(d=0)):2===a&&(d=$("#cantidad-combo-"+c).val(),d=parseInt(d),isNaN(d)&&(d=0)),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/usuario/listapersonal/lista/guardar",data:{codigo:c,tipo:a,unidades:d,render:!0},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?($("#modal-lista-guardar").length?$("#div-modal-agregar-lista").html(a.response.dialogoHTML):($("body").append('<div id="div-modal-agregar-lista"></div>'),$("#div-modal-agregar-lista").append(a.response.dialogoHTML)),$("#modal-lista-guardar").modal("show")):"error"===a.result&&alert(a.response)},error:function(a,b,c){alert("Error: "+c)}}),!1}),$(document).on("click","input[data-role='lstpersonalguardar']",function(){return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/listapersonal/lista/guardar",data:$("#form-listaguardar").serialize(),beforeSend:function(){$('div[id^="ListaGuardarForm_"].has-error').html(""),$('div[id^="ListaGuardarForm_"].has-error').css("display","none"),$("#form-listaguardar input[type=button]").attr("disabled","disabled"),Loading.show()},complete:function(){$("#form-listaguardar input[type=button]").removeAttr("disabled"),Loading.hide()},success:function(a){var a=$.parseJSON(a);"ok"===a.result?($("#modal-lista-guardar").modal("hide"),dialogoAnimado(a.response)):"error"===a.result?alert(a.response):$.each(a,function(a,b){$("#"+a+"_em_").html(b),$("#"+a+"_em_").css("display","block")})},error:function(a,b,c){alert("Error: "+c)}}),!1}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$.fn.clearForm=function(){return this.each(function(){var a=this.type,b=this.tagName.toLowerCase();return"form"==b?$(":input",this).clearForm():void("text"==a||"password"==a||"textarea"==b?this.value="":"checkbox"==a||"radio"==a?this.checked=!1:"select"==b&&(this.selectedIndex=-1))})},$(document).on("click","a[data-role='crearcotizacion']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/crearcotizacion",beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){dialogoAnimado(a.response)},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","a[data-role='carrovaciar']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/vaciar",beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"==a.result?($("#div-carro").html(a.carro),$("#div-carro").trigger("create"),$("#div-carro-canasta").html(a.canasta),$("#div-carro-canasta").trigger("create")):alert(a.response)},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","button[data-role='modificarcarro']",function(){var a=$(this).attr("data-position"),b=$(this).attr("data-modificar"),c=$(this).attr("data-operation"),d=0,e="";if(1==b){var f=1==$(this).attr("data-fraction");e=f?"#cantidad-producto-fraccion-"+a:"#cantidad-producto-unidad-"+a}else 2==b?e="#cantidad-producto-"+a:3==b&&(e="#cantidad-producto-bodega-"+a);d=parseInt($(e).val()),isNaN(d)||d<1?d=1:"+"==c?(d++,d<1&&(d=1)):"-"==c&&d>0&&(d--,d<1&&(d=1)),$(e).val(d),modificarCarro(a,b)}),$(document).on("change","input[data-role='modificarcarro']",function(){var a=parseInt($(this).val()),b=$(this).attr("data-position"),c=$(this).attr("data-modificar");(isNaN(a)||a<1)&&(a=1),$(this).val(a),modificarCarro(b,c)}),$(document).on("click","a[data-eliminar='1'], a[data-eliminar='2'], a[data-eliminar='3']",function(){var a=$(this).attr("data-position"),b=$(this).attr("data-eliminar");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/eliminar",data:{id:a,eliminar:b},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"==a.result?($("#div-carro").html(a.carro),
$("#div-carro").trigger("create"),$("#div-carro-canasta").html(a.canasta),$("#div-carro-canasta").trigger("create")):alert(a.response)},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","button[id='btn-carropagar-siguiente'], button[id='btn-carropagar-anterior']",function(){var a=$(this).attr("data-origin"),b=$(this).attr("data-redirect");return"informacion"===a?pasoInformacion(a,b,$(this)):"confirmacion"===a&&pasoConfirmacion(a,b,$(this)),!1}),$(document).on("click","button[data-role='pagopasarela']",function(){var boton=$(this);$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/pagopasarela",beforeSend:function(){boton.prop("disabled",!0),Loading.show()},complete:function(){Loading.hide()},success:function(data){"ok"==data.result?($("#div-pasarela-info form").remove(),$("#div-pasarela-info").append(data.response),eval(data.analytics),$('form[id="form-pasarela"]').submit()):(boton.prop("disabled",!1),alert(data.response))},error:function(a,b,c){boton.prop("disabled",!1),alert("Error: "+c)}})}),$(document).on("change","input[id^='FiltroForm_listMarcas_']",function(){recalcularFiltros(1)}),$(document).on("change","input[id^='FiltroForm_listFiltros_']",function(){recalcularFiltros(2)}),$(document).on("click","input[id^='FiltroForm_listCategoriasTienda_']",function(){filtrarListaProductos()}),$(document).on("click","a[data-role='filtro-listaproductos-reset']",function(){$("#form-filtro-listaproductos").clearForm();var a=[parseInt($("#FiltroForm_precio").attr("data-slider-min")),parseInt($("#FiltroForm_precio").attr("data-slider-max"))];setPrecioFiltroForm(a,!1),$("#FiltroForm_precio").slider("setValue",a),$("#calificacion-filtro-listaproductos").raty("score",0),$("#calificacion-filtro-listaproductos").attr("data-score",-1),"1"==$(this).attr("data-tipo")?recalcularFiltros(2):filtrarListaProductos()}),$(document).on("change","select[data-role='orden-listaproductos']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/filtrar",data:{"OrdenamientoForm[orden]":$("#OrdenamientoForm_orden").val()},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(a){"ok"===a.result?ListViewProductsUpdate():alert(a.response)},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}})}),$(document).on("slide","#FiltroForm_precio",function(){var a=$("#FiltroForm_precio").slider("getValue");setPrecioFiltroForm(a,!1)}),$(document).on("slideStop","#FiltroForm_precio",function(){var a=$("#FiltroForm_precio").slider("getValue");setPrecioFiltroForm(a,!0)}),$(document).on("change","#FiltroForm_precio_0_text",function(){var a=$(this).val();a=parseInt(a),isNaN(a)&&(a=parseInt($("#FiltroForm_precio").attr("data-slider-min"))),$("#FiltroForm_precio").slider("setValue",[a,$("#FiltroForm_precio").slider("getValue")[1]]),$("#FiltroForm_precio_0").val(a),$("#FiltroForm_precio_0_text").val("$"+format(a)),filtrarListaProductos()}),$(document).on("change","#FiltroForm_precio_1_text",function(){var a=$(this).val();a=parseInt(a),isNaN(a)&&(a=parseInt($("#FiltroForm_precio").attr("data-slider-max"))),$("#FiltroForm_precio").slider("setValue",[$("#FiltroForm_precio").slider("getValue")[0],a]),$("#FiltroForm_precio_1").val(a),$("#FiltroForm_precio_1_text").val("$"+format(a)),filtrarListaProductos()}),$(document).on("click","a[id='btn-buscador-productos']",function(){var a=$(this).parents("form"),b=$("input[id='busqueda']").val().trim();isEmptyStr(b)||a.submit()}),$(document).on("click","div[data-role='formapago']",function(){var a=$(this).attr("data-tipo");if("datafono"==a)return $("#modal-formapago input[type='radio']").removeAttr("checked"),$("#modal-formapago #idFormaPago_"+$("#FormaPagoForm_idFormaPago_datafono").val()).prop("checked",!0),$("div[data-role^='formapago-logo-']").addClass("display-none"),$("div[data-role='formapago-logo-"+$("#FormaPagoForm_idFormaPago_datafono").val()+"']").removeClass("display-none"),$("#modal-formapago").modal("show"),!1;var b=$("div[data-role='formapago-descripcion']div[data-tipo='"+a+"']");$("div[data-role='formapago-descripcion']").addClass("display-none"),b.length>0&&b.removeClass("display-none")}),$(document).on("click","#modal-formapago input[type='radio']",function(){$(this).is(":checked")&&($('input[id="FormaPagoForm_idFormaPago_datafono"]').prop("checked",!0),$('input[id="FormaPagoForm_idFormaPago_datafono"]').val($(this).val()),$("div[data-role^='formapago-logo-']").addClass("display-none"),$("div[data-role='formapago-logo-"+$(this).val()+"']").removeClass("display-none"),$("div[data-role='formapago-logo-pagoenlinea']").addClass("display-none"),$("div[data-role='formapago-descripcion']").addClass("display-none"))}),$(document).ready(function(){$(function(){var a=$("textarea[data-countchar]");a.length&&countChar(a,a.attr("data-countchar"))}),raty()}),$(document).on("keypress","#form-autenticar",function(a){13==a.keyCode&&($("#form-autenticar input[data-registro-desktop='autenticar']").trigger("click"),a.preventDefault())}),$(document).ready(function(){$('[data-toggle="popover"]').popover(),$("input[data-role='bootstrap-slider']").slider(),$(".slide-productos").owlCarousel({items:5,lazyLoad:!0,navigation:!0,pagination:!1,navigationText:["<i class='glyphicon glyphicon-chevron-left'></i>","<i class='glyphicon glyphicon-chevron-right'></i>"],autoPlay:3e3}),$(".ad-gallery").adGallery({loader_image:requestUrl+"/libs/ad-gallery/loader.gif",update_window_hash:!1,width:400,height:300,thumb_opacity:.7,hooks:{displayDescription:function(a){}}})}),$(".ciudades").select2(),$(document).on("click",'button[data-role="ubicacion-gps"]',function(){ubicacionGPS()}),$(document).on("click",'button[data-role="seleccion-barrio"]',function(){return $("#modal-ubicacion-barrios").length>0?($("#ubicacion-barrios-respuesta").html(""),$("#modal-ubicacion-barrios").modal("show")):$.ajax({type:"GET",async:!0,url:requestUrl+"/sitio/seleccionBarrio",dataType:"html",beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){$("#main-page").append(a),$("#selector-ciudad").select2(),$("#modal-ubicacion-barrios").modal("show")},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}),!1}),$(document).on("click",'button[data-role="ubicacion-barrio"]',function(){var a=$("#selector-ciudad").val(),b=$("input[name='barrio']").val();return $.ajax({type:"post",async:!0,url:requestUrl+"/sitio/ubicacionBarrio",data:{ciudad:a,barrio:b},dataType:"json",beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){"ok"==a.result?a.response?($("#ubicacion-seleccion-ciudad").val(a.response.ciudad),$("#ubicacion-seleccion-sector").val(a.response.sector),$("#ubicacion-seleccion-direccion").val(""),ubicacionSeleccion()):a.responseHTML?$("#ubicacion-barrios-respuesta").html(a.responseHTML):(Loading.hide(),alert("Respuesta incorrecta")):(Loading.hide(),alert(a.response))},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}),!1}),$(document).on("click",'a[data-role="ubicacion-barriosOpciones"]',function(){return $("#ubicacion-seleccion-ciudad").val($(this).attr("data-ciudad")),$("#ubicacion-seleccion-sector").val($(this).attr("data-sector")),$("#ubicacion-seleccion-direccion").val(""),ubicacionSeleccion(),!1}),$(document).on("click",'button[data-role="pasoporel-seleccion-pdv"]',function(){seleccionTipoEntrega(tipoEntrega.presencial,tipoEntrega.domicilio),$("#pasoporel-seleccion-pdv-nombre").html($(this).attr("data-nombre")),$("#pasoporel-seleccion-pdv-direccion").html($(this).attr("data-direccion")),$("#modal-pasoporel-seleccionar").modal("hide"),$('input[name="FormaPagoForm[indicePuntoVenta]"]').val($(this).attr("data-idx"))}),$(document).on("click",'div[data-role="tipoentrega"]',function(){var a=$(this).attr("data-tipo"),b=a==tipoEntrega.presencial?tipoEntrega.domicilio:tipoEntrega.presencial;a==tipoEntrega.presencial?$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/pasoporel",data:{opcion:"modal"},beforeSend:function(){$("#modal-pasoporel-seleccionar").remove(),Loading.show()},success:function(a){"ok"==a.result?($("body").append(a.response),$("#modal-pasoporel-seleccionar").modal("show")):alert(a.response),Loading.hide()},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}):seleccionTipoEntrega(a,b)}),$(document).on("click",'button[data-role="ubicacion-direccion"]',function(){return $.ajax({type:"GET",async:!0,url:requestUrl+"/usuario/direccionesUbicacion",dataType:"html",beforeSend:function(){$("#modal-ubicacion-direcciones").remove(),Loading.show()},complete:function(a){Loading.hide()},success:function(a){$("#main-page").append(a),$("#modal-ubicacion-direcciones").modal("show")},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}),!1}),$(document).on("click",'button[data-role="ubicacion-seleccion-direccion"]',function(){$("#ubicacion-seleccion-ciudad").val(""),$("#ubicacion-seleccion-sector").val(""),$("#ubicacion-seleccion-direccion").val($(this).attr("data-direccion")),$("#div-ubicacion-tipoubicacion > button").removeClass("activo").addClass("inactivo"),$('#div-ubicacion-tipoubicacion > button[data-role="ubicacion-direccion"]').removeClass("inactivo").addClass("activo"),ubicacionSeleccion()}),$(document).on("click",'a[data-role="ubicacion-seleccion-nodomicilio"]',function(){$("#ubicacion-seleccion-ciudad").val($(this).attr("data-ciudad")),$("#ubicacion-seleccion-sector").val($(this).attr("data-sector")),$("#ubicacion-seleccion-direccion").val(""),ubicacionSeleccion()}),$(document).on("click",'button[data-role="ubicacion-mapa"]',function(){if($("#select-ubicacion-content").show(),lat=4.704009,lng=-74.042832,$("#modal-ubicacion-map").length>0){$("#modal-ubicacion-map").modal("show");var a=new google.maps.LatLng(lat,lng);map.setCenter(a),map.setZoom(6),resizeMap(),tourIniMap&&(setTimeout(function(){iniciarTour()},1e3),tourIniMap=!1)}else $.ajax({type:"POST",dataType:"html",async:!0,url:requestUrl+"/sitio/mapa",beforeSend:function(){Loading.show()},success:function(a){$.getScript("https://maps.googleapis.com/maps/api/js?client="+gmapKey).done(function(b,c){$.getScript(requestUrl+"/js/ubicacion.min.js").done(function(b,c){$("#main-page").append(a),$("#select-ubicacion-psubsector .ciudades").select2(),inicializarMapa(),$("#modal-ubicacion-map").modal("show");var d=new google.maps.LatLng(lat,lng);map.setCenter(d),map.setZoom(6),resizeMap(),tourIniMap&&(setTimeout(function(){iniciarTour()},1e3),tourIniMap=!1),Loading.hide()}).fail(function(a,b,c){Loading.hide(),alert("Error al inicializar mapa: "+c)})}).fail(function(a,b,c){Loading.hide(),alert("Error al cargar mapa: "+c)})},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}});return!1}),$(document).on("click",'button[data-role="ubicacion-seleccion-mapa"]',function(){Loading.show();var a=0,b=0;return map&&(a=map.getCenter().lat(),b=map.getCenter().lng()),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/sitio/gps",data:{lat:a,lon:b},beforeSend:function(){$("#modal-no-serviciodomicilio").remove(),Loading.show()},success:function(a){"ok"==a.result?($("#ubicacion-seleccion-ciudad").val(a.response.ciudad),$("#ubicacion-seleccion-sector").val(a.response.sector),$("#ubicacion-seleccion-direccion").val(""),$("#div-ubicacion-tipoubicacion > button").removeClass("activo").addClass("inactivo"),$('#div-ubicacion-tipoubicacion > button[data-role="ubicacion-mapa"]').removeClass("inactivo").addClass("activo"),tourIniGps&&(setTimeout(function(){iniciarTour()},1e3),tourIniGps=!1),ubicacionSeleccion()):a.responseModal?($("body").append(a.responseModal),$("#modal-no-serviciodomicilio").modal("show")):alert(a.response),Loading.hide()},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}),!1}),$(document).on("change",'select[data-role="ciudad-despacho-map"]',function(){var a=$(this).val().trim();if(a.length>0){var b=$('select[data-role="ciudad-despacho-map"] option[value="'+a+'"]').attr("selected","selected");map&&(map.setCenter(new google.maps.LatLng(parseFloat(b.attr("data-latitud")),parseFloat(b.attr("data-longitud")))),map.setZoom(13))}}),$(document).on("click","a[data-cargar='2']",function(){var a=$(this).attr("data-combo"),b=$("#cantidad-combo-"+a).val();return b=parseInt(b),isNaN(b)&&(b=0),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarCombo",data:{combo:a,cantidad:b},beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){"ok"===a.result?($("#div-carro-canasta").html(a.response.canastaHTML),$("#div-carro-canasta").trigger("create"),a.response.mensajeHTML&&(dialogoAnimado(a.response.mensajeHTML),$("#cantidad-productos").html(a.response.objetosCarro)),a.response.dialogoHTML&&alert(a.response.dialogoHTML)):alert(a.response)},error:function(a,b,c){alert("Error: "+c)}}),!1}),$(document).on("click","a[data-cargar='1']",function(){var a=$(this).attr("data-producto"),b=$(this).attr("data-id"),c=$("#cantidad-producto-unidad-"+a+"-"+b).val();c=parseInt(c),isNaN(c)&&(c=-1);var d=parseInt($("#cantidad-producto-fraccion-"+a+"-"+b).val());return d=parseInt(d),isNaN(d)&&(d=-1),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregar",data:{producto:a,cantidadU:c,cantidadF:d},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(b){"ok"===b.result?($("#div-carro-canasta").html(b.response.canastaHTML),$("#div-carro-canasta").trigger("create"),b.response.mensajeHTML&&(dialogoAnimado(b.response.mensajeHTML),$("#icono-producto-agregado-"+a).addClass("active"),$("#cantidad-productos").html(b.response.objetosCarro)),b.response.dialogoHTML&&($("#modalBodegas").remove(),$("body").append(b.response.dialogoHTML),$("#modalBodegas").modal("show"))):alert(b.response)},error:function(a,b,c){alert("Error: "+c)}}),!1}),$(document).on("click","a[data-cargar='3']",function(){var a=$(this).attr("data-producto"),b=$("#cantidad-producto-ubicacion-"+a).val();b=parseInt(b),isNaN(b)&&(b=0);var c=parseInt($("#cantidad-producto-bodega-"+a).val());return c=parseInt(c),isNaN(c)&&(c=0),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/carro/agregarBodega",data:{producto:a,cantidadU:b,cantidadB:c},beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){"ok"===a.result?($("#div-carro-canasta").html(a.response.canastaHTML),$("#div-carro-canasta").trigger("create"),a.response.mensajeHTML&&(dialogoAnimado(a.response.mensajeHTML),$("#cantidad-productos").html(a.response.objetosCarro)),a.response.dialogoHTML&&alert(a.response.dialogoHTML)):alert(a.response)},error:function(a,b,c){alert("Error: "+c)}}),!1}),$(document).on("click","#form-autenticar input[data-registro-desktop='autenticar']",function(){var a=$(this).parents("form"),b=$(this);return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/ingresar",data:a.serialize(),beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(b){var c=$.parseJSON(b);"ok"===c.result?window.location.replace(c.response.redirect):"error"===c.result||$.each(c,function(b,c){$("#"+a.attr("id")+" #"+b+"_em_").html(c),$("#"+a.attr("id")+" #"+b+"_em_").css("display","block")})},error:function(a,c,d){b.button("enable"),alert("Error: "+d)}}),!1}),$(document).on("click","#form-registro input[data-registro-desktop='registro']",function(){var a=$(this).parents("form");$(this);return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/registro",data:a.serialize(),beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(b){var c=$.parseJSON(b);"ok"===c.result?($("#main-content").html(c.response.bienvenidaHTML),$("#main-content").trigger("create")):"error"===c.result||$.each(c,function(b,c){$("#"+a.attr("id")+" #"+b+"_em_").html(c),$("#"+a.attr("id")+" #"+b+"_em_").css("display","block")})},error:function(a,b,c){alert("Error: "+c)}}),!1}),$(document).on("click","#form-registro input[data-registro-desktop='recordar']",function(){var a=$(this).parents("form");$(this);return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/registro",data:a.serialize(),beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(b){var c=$.parseJSON(b);"ok"===c.result?$("#main-page").html(c.response.bienvenidaHTML):"error"===c.result?alert(c.response):$.each(c,function(b,c){$("#"+a.attr("id")+" #"+b+"_em_").html(c),$("#"+a.attr("id")+" #"+b+"_em_").css("display","block")})},error:function(a,b,c){Loading.hide(),alert("Error: "+c)}}),!1}),$(document).on("click","#form-recordar input[data-registro-desktop='recordar']",function(){var a=$(this).parents("form"),b=$(this);return $.ajax({type:"POST",async:!0,url:requestUrl+"/usuario/recordar",data:a.serialize(),beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(b){var c=$.parseJSON(b);"ok"===c.result?(a.trigger("reset"),alert(c.response)):"error"===c.result?alert(c.response):$.each(c,function(b,c){$("#"+a.attr("id")+" #"+b+"_em_").html(c),$("#"+a.attr("id")+" #"+b+"_em_").css("display","block")})},error:function(a,c,d){b.button("enable"),alert("Error: "+d)}}),!1}),$(document).on("click","a[data-role='comparar']",function(){var a=$(this).attr("data-producto");return $.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/agregarProductoComparar",data:{producto:a},beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){"ok"===a.result&&($("#cantidad-productos-comparar").html(a.productos),a.productos>=a.maximoComparar?$(".btnComparar").css("display","none"):$(".btnComparar").css("display","block"))},error:function(a,b,c){alert("Error: "+c)}}),!1}),$(document).on("click","a[data-role='quitarComparar']",function(){var a=$(this).attr("data-producto");$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/catalogo/quitarProductoComparar",data:{producto:a},beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(b){"ok"===b.result&&($("#cantidad-productos-comparar").html(b.productos),$("#comparacion-producto-"+a).css("display","none"),b.productos>=b.maximoComparar?$(".btnComparar").css("display","none"):$(".btnComparar").css("display","block"))},error:function(a,b,c){alert("Error: "+c)}})}),$(document).on("click","a[data-registro-desktop='autenticar']",function(){$(this).parents("form"),$(this)}),$(document).on("click","a[data-role='compararProductos']",function(){return $.ajax({type:"GET",async:!0,url:requestUrl+"/catalogo/verProductosComparar",beforeSend:function(){Loading.show(),$("#modal-comparar-productos").remove()},complete:function(){Loading.hide()},success:function(a){$("#main-page").append(a),$("#modal-comparar-productos").modal("show")},error:function(a,b,c){alert(b+"")}}),!1}),$(document).on("click","button[data-role='disminuir-cantidad']",function(){var a=$(this).attr("data-producto"),b=$(this).attr("data-id"),c=$(this).attr("data-precio"),d=$("#cantidad-producto-unidad-"+a+"-"+b).val();d--,d<0&&(d=0),$("#subtotal-producto-unidad-"+a).html("$"+format(d*c)),$("#cantidad-producto-unidad-"+a+"-"+b).val(d)}),$(document).on("change","input[data-role='validar-cantidad-unidad']",function(){var a=$(this).attr("data-producto"),b=$(this).attr("data-precio"),c=$(this).attr("data-id"),d=$(this).val();d<0&&(d=0),$("#subtotal-producto-unidad-"+a).html("$"+format(d*b)),$("#cantidad-producto-unidad-"+a+"-"+c).val(d)}),$(document).on("click","button[data-role='aumentar-cantidad']",function(){var a=$(this).attr("data-producto"),b=$(this).attr("data-precio"),c=$(this).attr("data-id"),d=$("#cantidad-producto-unidad-"+a+"-"+c).val();d++,d<0&&(d=0),$("#subtotal-producto-unidad-"+a).html("$"+format(d*b)),$("#cantidad-producto-unidad-"+a+"-"+c).val(d)}),$(document).on("click","button[data-role='guardarCalificacion']",function(){var a=$(this).attr("data-producto"),b=$("#form-calificacion");$.ajax({type:"POST",url:requestUrl+"/catalogo/calificar/",data:"codigo="+a+"&"+b.serialize(),dataType:"json",beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){"ok"===a.result?($("[data-role='calificacion']").remove(),$("#calificacion-producto").html("<div class='col-md-6'>TU COMENTARIO HA SIDO PUBLICADO, ESTE SERÁ APROBADO POR UN MODERADOR EN LAS PRÓXIMAS HORAS</div>")):"error"===a.result?($("#dialog").html(a.response),$("#dialog").dialog("open")):$.each(a,function(a,c){$("#"+b.attr("id")+" #"+a+"_em_").html(c),$("#"+b.attr("id")+" #"+a+"_em_").css("display","block")})}})}),$(document).on("click","#btn-adicionar-formula",function(){var a=document.getElementById("form-pago-confirmacion");return $.ajax({type:"POST",url:requestUrl+"/carro/adicionarFormula/",data:new FormData(a),dataType:"json",cache:!1,contentType:!1,processData:!1,beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){"ok"===a.result?($("#FormulasMedicas_nombreMedico").val(""),$("#FormulasMedicas_institucion").val(""),$("#FormulasMedicas_registroMedico").val(""),$("#FormulasMedicas_descripcion").val(""),$("#FormulasMedicas_formulaMedica").val(""),$("#FormulasMedicas_telefono").val(""),$("#FormulasMedicas_correoElectronico").val(""),$("#formulasAdicionadas").html(a.response)):"error"===a.result||$.each(a,function(a,b){$("#"+a+"_em_").html(b),$("#"+a+"_em_").css("display","block")})}}),!1});var bono;$(document).on("click","button[data-role='codigo-promocional']",function(){var a=$("#codigoPromocional").val();return $.ajax({type:"POST",url:requestUrl+"/carro/usarCodigo/",data:{codigoPromocional:a},dataType:"json",beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){"ok"===a.result?(bono=a.bono,bootbox.dialog({message:a.response,title:"Bono disponible",buttons:{success:{label:"Usar",className:"btn-primary",callback:function(){$.ajax({type:"POST",url:requestUrl+"/carro/guardarCodigo/",data:{bono:bono},dataType:"json",beforeSend:function(){Loading.show()},complete:function(a){Loading.hide()},success:function(a){return"ok"==a.result?($("#FormaPagoForm-usoBonoPromocional").val(1),$("#FormaPagoForm-usoBonoPromocional").prop("disabled",!1),$("#codigoPromocional").val(""),$("#modal-promocional").modal("hide"),dialogoAnimado(a.response),$("#uso-codigo-div").html(a.response),!1):void alert(a.response)}})}},close:{label:"Cancelar",className:"btn-default",callback:function(){}}}})):"error"===a.result?$("#usoCodigo").html(a.response):$.each(a,function(a,b){$("#"+a+"_em_").html(b),$("#"+a+"_em_").css("display","block")})}}),!1});