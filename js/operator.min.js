function gestionPedido(o,a){$.ajax({type:"POST",async:!0,url:requestUrl+o,data:a,beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(o){$("#div-detalle-pedido").html(o)},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}function buscarProductos(o,a,e){$.ajax({type:"POST",async:!0,url:e+"/callcenter/pedido/buscar",data:{busqueda:o,compra:$(a).attr("data-pedido")},beforeSend:function(){$("#modal-productos-busqueda").remove(),Loading.show()},success:function(o){$("#container").append(o),$("#modal-productos-busqueda").modal("show")},complete:function(){Loading.hide()},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+o.responseText)}})}function dialogoAnimado(o){var a="dialogo-carro-"+uniqueId();$("<div class='dialogo-animado' id='"+a+"'>"+o+"</div>").appendTo("body"),$("#"+a).animate({opacity:1,bottom:"+=2%"},400,function(){setTimeout(function(){$("#"+a).animate({opacity:0,bottom:"-=2%"},400,function(){$("#"+a).remove()})},3e3)})}function uniqueId(){for(var o=(new Date).getTime();o==(new Date).getTime(););return(new Date).getTime()}var refresh=null;$(document).on("change","input[id=check-pedido-seguimiento]",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/seguimiento",data:{seguimiento:$("input[id=check-pedido-seguimiento]:checked").is(":checked")?1:0,compra:$(this).attr("data-compra")},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(o){"error"==o.result&&bootbox.alert(o.response)},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("click",'a[data-role="completitud-pdv"]',function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/subasta/admin/completitudPdv",data:{compra:$(this).attr("data-compra")},beforeSend:function(){$("#modalSubasta").remove(),clearTimeout(refresh),Loading.show()},complete:function(){Loading.hide()},success:function(o){"ok"==o.result?($("#container").append(o.response),$("#modalSubasta").modal({keyboard:!1,backdrop:"static"})):bootbox.alert(o.response)},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("click","a[data-action='modal']",function(){var o=$("#recargar-pagina").val();$.fn.yiiGridView.update("pedidos-grid"),$("#modalSubasta").modal("hide"),refresh=setTimeout(function(){location.reload()},o)}),$(document).on("click","a[data-role='asignar-pedido-pdv']",function(){var o=$(this).attr("data-pedido"),a=$("#recargar-pagina").val();$.ajax({type:"POST",async:!0,url:requestUrl+"/subasta/admin/asignarPdv",data:{dataPedido:o},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(o){var o=$.parseJSON(o);"ok"==o.result?(bootbox.alert(o.response),$.fn.yiiGridView.update("pedidos-grid"),$("#modalSubasta").modal("hide"),refresh=setTimeout(function(){location.reload()},a)):"error"==o.result&&bootbox.alert(o.response),Loading.hide()},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("click",'button[data-action="asignar-pdv"]',function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/asignarpdv",data:{compra:$(this).attr("data-compra"),pdv:$("#select-pdv-asignar").val()},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(o){"ok"==o.result?$("#div-encabezado-pedido").html(o.response.htmlEncabezado):bootbox.alert(o.response)},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("click",'button[data-action="saldo-pdv"]',function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/buscarsaldo",data:{idCompra:$(this).attr("data-compra"),pdv:$("#select-pdv-saldo").val()},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(o){"1"==o.result?$("#div-saldos-pdv").html(o.response.htmlSaldo):bootbox.alert(o.response.descripcion)},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("click",'button[data-action="remitir"]',function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/remitir",data:{idCompra:$(this).attr("data-compra")},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(o){1==o.result&&($("#div-encabezado-pedido").html(o.encabezado),$("#div-pedido-observaciones").html(o.htmlObservaciones)),bootbox.alert(o.response)},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("click",'button[data-action="remitirborrar"]',function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/remitirBorrar",data:{idCompra:$(this).attr("data-compra")},beforeSend:function(){Loading.show()},complete:function(){Loading.hide()},success:function(o){1==o.result&&($("#div-encabezado-pedido").html(o.encabezado),$("#div-pedido-observaciones").html(o.htmlObservaciones)),bootbox.alert(o.response)},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("click","button[data-role='modificarpedido']",function(){var o=$(this).attr("data-action"),a={accion:o};if(11==o){var e=$(this).attr("data-item"),t=parseInt($("#cantidad-item-unidad-"+e).val());isNaN(t)&&(t=-1),a.cantidad=t,a.item=e}else if(12==o){var e=$(this).attr("data-item"),r=parseInt($("#cantidad-item-fraccion-"+e).val());isNaN(r)&&(r=-1),a.cantidad=r,a.item=e}else if(13==o){var e=$(this).attr("data-item"),i=parseInt($("#cantidad-item-bodega-"+e).val());isNaN(i)?i=-1:0>i&&(i=0),a.cantidad=i,a.item=e}else if(2==o){var n=$(this).attr("data-compra"),d=$(this).attr("data-combo"),c=parseInt($("#cantidad-item-unidad-"+n).val());isNaN(c)?c=-1:0>c&&(c=0),a.compra=n,a.combo=d,a.cantidad=c}$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/modificar",data:a,beforeSend:function(){Loading.show()},success:function(o){"ok"===o.result?($("#div-detalle-pedido").html(o.response.htmlDetalle),$("#div-encabezado-pedido").html(o.response.htmlEncabezado),Loading.hide()):(Loading.hide(),bootbox.alert(o.response))},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("change","#notificacion-form #NotificacionForm_tipoObservacion",function(){var o=$(this).val();o?$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/admin/observacionmensaje",data:{tipo:o,compra:$(this).attr("data-compra")},beforeSend:function(){Loading.show()},success:function(o){"ok"===o.result?($("#notificacion-form #NotificacionForm_observacion").val(o.response),Loading.hide()):(Loading.hide(),bootbox.alert(o.response))},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}}):$("#notificacion-form #NotificacionForm_observacion").val("")}),$("#busqueda-buscar").keypress(function(o){if(13==o.which){var a=$.trim($("#busqueda-buscar").val());return a?buscarProductos(a,this,requestUrl):bootbox.alert("Búsqueda no puede estar vacío"),!1}}),$(document).on("click","button[data-role='busquedapedido']",function(){var o=$.trim($("#busqueda-buscar").val());o?buscarProductos(o,this,requestUrl):bootbox.alert("Búsqueda no puede estar vacío")}),$(document).on("click","a[data-role='beneficiositem']",function(){$.ajax({type:"POST",async:!0,url:requestUrl+"/callcenter/pedido/beneficios",data:{item:$(this).attr("data-item")},beforeSend:function(){$("#modal-beneficios-compra").remove(),Loading.show()},success:function(o){$("#container").append(o),$("#modal-beneficios-compra").modal("show")},complete:function(){Loading.hide()},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+o.responseText)}})}),$(document).on("click","button[data-role='disponibilidaditem']",function(){var o={};$(this).attr("data-item")?o.item=$(this).attr("data-item"):$(this).attr("data-combo")&&(o.combo=$(this).attr("data-combo"),o.compra=$(this).attr("data-compra")),$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/disponibilidad",data:o,beforeSend:function(){Loading.show()},success:function(o){"ok"===o.result?($("#div-detalle-pedido").html(o.response.htmlDetalle),Loading.hide()):(Loading.hide(),alert(o.response))},error:function(o,a,e){Loading.hide(),alert("Error: "+o.responseText)}})}),$(document).on("click","a[data-role='aprobar-calificacion']",function(){var o=$(this).attr("data-calificacion");bootbox.dialog({message:"¿ Está seguro de aprobar este comentario ?",title:"Aprobar comentario",buttons:{success:{label:"Aceptar",className:"btn-primary",callback:function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/admin/aprobarCalificacion",data:{calificacion:o},beforeSend:function(){Loading.show()},success:function(o){"ok"===o.result?($.fn.yiiGridView.update("grid-calificaciones"),Loading.hide()):(Loading.hide(),bootbox.alert(o.response))},error:function(o,a,e){Loading.hide(),alert("Error: "+o.responseText)}})}},close:{label:"Cancelar",className:"btn-default",callback:function(){}}}})}),$(document).on("click","a[data-cargar='1'], a[data-cargar='2']",function(){var o=$(this).attr("data-cargar"),a=$("#btn-pedido-buscar").attr("data-pedido"),e={tipo:o,compra:a};if(1==o){var t=$(this).attr("data-producto"),r=$("#cantidad-producto-unidad-"+t).val();r=parseInt(r),isNaN(r)&&(r=-1);var i=parseInt($("#cantidad-producto-fraccion-"+t).val());i=parseInt(i),isNaN(i)&&(i=-1),e.producto=t,e.cantidadU=r,e.cantidadF=i}else if(2==o){var n=$(this).attr("data-combo"),d=$("#cantidad-combo-"+n).val();d=parseInt(d),isNaN(d)&&(d=0),e.combo=n,e.cantidad=d}$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/agregar",data:e,beforeSend:function(){Loading.show()},success:function(o){"ok"===o.result?($("#div-detalle-pedido").html(o.response.htmlDetalle),$("#div-encabezado-pedido").html(o.response.htmlEncabezado),Loading.hide()):(Loading.hide(),bootbox.alert(o.response))},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})}),$(document).on("click","button[data-role='pdvgeodireccion']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/admin/geodireccion",data:{ciudad:$("#select-ciudad-direccion").val(),direccion:$("#input-pedido-direccion").val()},beforeSend:function(){$("#div-pedido-georeferencia-direcion").html(""),Loading.show()},success:function(o){"ok"===o.result?($("#div-pedido-georeferencia-direcion").html(o.response),Loading.hide()):(Loading.hide(),bootbox.alert(o.response))},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+o.responseText)}})}),$(document).on("change","#Operador_perfil",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/operador/verificarPerfil",data:{perfil:$(this).val()},beforeSend:function(){Loading.show()},success:function(o){"ok"===o.result?(2==o.response?$("#form-pdv-vendedor").css("display","block"):$("#form-pdv-vendedor").css("display","none"),3==o.response?$("#form-pdv-mensajero").css("display","block"):$("#form-pdv-mensajero").css("display","none"),Loading.hide()):(Loading.hide(),bootbox.alert(o.response))},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+o.responseText)}})}),$(document).on("click","button[data-role='pdvgeobarrio']",function(){$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/admin/geobarrio",data:{ciudad:$("#select-ciudad-barrio").val(),barrio:$("#input-pedido-barrio").val()},beforeSend:function(){$("#div-pedido-georeferencia-barrio").html(""),Loading.show()},success:function(o){"ok"===o.result?($("#div-pedido-georeferencia-barrio").html(o.response),Loading.hide()):(Loading.hide(),bootbox.alert(o.response))},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+o.responseText)}})}),$(document).on("click","button[data-role='trazapasarela']",function(){$.ajax({type:"POST",async:!0,url:requestUrl+"/callcenter/pedido/trazapasarela",data:{compra:$(this).attr("data-pedido")},beforeSend:function(){$("#modal-trazapasarela").remove(),Loading.show()},success:function(o){$("#container").append(o),$("#modal-trazapasarela").modal("show")},complete:function(){Loading.hide()},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+o.responseText)}})}),$(document).on("click","button[data-role='modificar-ahorro']",function(){$("#modal-modificar-ahorro-label > span").html(1==$(this).attr("data-opcion")?"unidades":"fracciones"),$("#modal-modificar-ahorro-label > div").html($(this).attr("data-descripcion")),$("#ModificarAhorroForm_descuento").val($(this).attr("data-ahorro")),$("#ModificarAhorroForm_idCompraItem").val($(this).attr("data-item")),$("#ModificarAhorroForm_opcion").val($(this).attr("data-opcion")),$("#modal-modificar-ahorro").modal("show")}),$(document).on("click","button[data-role='modificar-ahorro-guardar']",function(){var o=$("#form-modificar-ahorro"),a=$(this);$.ajax({type:"POST",dataType:"json",async:!0,url:requestUrl+"/callcenter/pedido/modificarahorro",data:o.serialize(),beforeSend:function(){a.prop("disabled",!0),$('div[id^="ModificarAhorroForm_"].has-error').html(""),$('div[id^="ModificarAhorroForm_"].has-error').css("display","none"),Loading.show()},success:function(o){"ok"===o.result?($("#modal-modificar-ahorro").modal("hide"),$("#div-detalle-pedido").html(o.response.htmlDetalle),$("#div-encabezado-pedido").html(o.response.htmlEncabezado)):"error"===o.result?bootbox.alert(o.response):$.each(o,function(o,a){$("#"+o+"_em_").html(a),$("#"+o+"_em_").css("display","block")}),a.prop("disabled",!1),Loading.hide()},error:function(o,e,t){Loading.hide(),a.prop("disabled",!1),bootbox.alert("Error: "+o.responseText)}})}),$(document).on("click","a[data-role='bonotienda-reactivar']",function(){return $.ajax({type:"POST",dataType:"json",async:!0,url:$(this).attr("href"),data:{render:!0},beforeSend:function(){$("#modal-reactivar-bono").remove(),Loading.show()},complete:function(){Loading.hide()},success:function(o){"ok"==o.result?($("body").append(o.response),$("#modal-reactivar-bono").modal("show")):alert(o.response)},error:function(o,a,e){Loading.hide(),alert("Error: "+e)}}),!1}),$(document).on("click","input[data-role='bonotienda-reactivar']",function(){var o=$(this).parents("form");$.ajax({type:"POST",async:!0,url:requestUrl+"/callcenter/bonos/reactivar/id/"+$(this).attr("data-bono"),data:o.serialize(),beforeSend:function(){$('div[id^="ReactivarBonoTiendaForm_"].text-danger').html(""),$('div[id^="ReactivarBonoTiendaForm_"].text-danger').css("display","none"),Loading.show()},complete:function(){Loading.hide()},success:function(a){var a=$.parseJSON(a);"ok"==a.result?($.fn.yiiGridView.update("bonos-tienda-grid"),$("#modal-reactivar-bono").modal("hide"),dialogoAnimado(a.response)):"error"==a.result?bootbox.alert(a.response):$.each(a,function(a,e){$("#"+o.attr("id")+" #"+a+"_em_").html(e),$("#"+o.attr("id")+" #"+a+"_em_").css("display","block")}),Loading.hide()},error:function(o,a,e){Loading.hide(),bootbox.alert("Error: "+e)}})});